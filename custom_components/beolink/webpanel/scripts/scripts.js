
function formatError(a, b) { var c = ""; return a.data && a.data.message ? c = a.data.message : a.status && 403 == a.status && (c = "you don't have management privileges over \"" + b + '"'), c } function testLocalStorage() { var a = !0; try { localStorage.setItem("test", !0), localStorage.removeItem("test") } catch (b) { a = !1 } return a } function parseUri(a) { for (var b = parseUri.options, c = b.parser[b.strictMode ? "strict" : "loose"].exec(a), d = {}, e = 14; e--;)d[b.key[e]] = c[e] || ""; return d[b.q.name] = {}, d[b.key[12]].replace(b.q.parser, function (a, c, e) { c && (d[b.q.name][c] = e) }), d } function urlInjectAuth(a, b, c) { var d; return b.length > 0 && c.length > 0 ? (urlp = parseUri(a), b.length > 0 && c.length > 0 && (urlp.user = b, urlp.password = c), d = urlp.protocol + "://", urlp.user.length > 0 && urlp.password.length > 0 && (d += urlp.user + ":" + urlp.password + "@"), d += urlp.host, urlp.port.length > 0 && (d += ":" + urlp.port), d += "/" + urlp.relative) : d = a, d } function sizeCameraDynamic() { var a, b = window.innerWidth, c = b - .18 * b; return a = b > bigWidth ? (c - .1 * c) / 4 : b > mediumWidth && bigWidth >= b ? 3 * (c - .1 * c) / 8 : smallWidth >= b ? 180 : 3 * (c - .1 * c) / 4 } if (!VK_ENTER) var VK_ENTER = 13; if (!VK_PAUSE) var VK_PAUSE = 19; if (!VK_LEFT) var VK_LEFT = 37; if (!VK_UP) var VK_UP = 38; if (!VK_RIGHT) var VK_RIGHT = 39; if (!VK_DOWN) var VK_DOWN = 40; if (!VK_0) var VK_0 = 48; if (!VK_1) var VK_1 = 49; if (!VK_2) var VK_2 = 50; if (!VK_3) var VK_3 = 51; if (!VK_4) var VK_4 = 52; if (!VK_5) var VK_5 = 53; if (!VK_6) var VK_6 = 54; if (!VK_7) var VK_7 = 55; if (!VK_8) var VK_8 = 56; if (!VK_9) var VK_9 = 57; if (!VK_RED) var VK_RED = 403; if (!VK_GREEN) var VK_GREEN = 404; if (!VK_YELLOW) var VK_YELLOW = 502; if (!VK_BLUE) var VK_BLUE = 406; if (!VK_REWIND) var VK_REWIND = 412; if (!VK_STOP) var VK_STOP = 413; if (!VK_PLAY) var VK_PLAY = 415; if (!VK_FAST_FWD) var VK_FAST_FWD = 473; if (!VK_BACK) var VK_BACK = 461; if (!VK_STEP_UP) var VK_STEP_UP = 425; if (!VK_STEP_DW) var VK_STEP_DW = 424; "undefined" != typeof isWebOS && isWebOS && (VK_YELLOW = 405, VK_FAST_FWD = 417, VK_STEP_UP = 33, VK_STEP_DW = 34); var BK_RED = 90, BK_GREEN = 71, BK_YELLOW = 67, BK_BLUE = 68, BK_REWIND = 91, BK_STOP = 76, BK_PAUSE = 76, BK_PLAY = 80, BK_FAST_FWD = 93, BK_BACK = 9, BK_STEP_UP = 117, BK_STEP_DW = 106, model = angular.module("hagw.model", []); model.factory("commTimeout", function () { return { DEFAULT_TIMEOUT: 2e4, GET_TIMEOUT: 4e4, EXECUTE_TIMEOUT: 24e4, NOTIFICATION_TIMEOUT: 4e4 } }), model.provider("model", function () { var a = {}; this.setOrderFilter = function (b, c) { a[b] = c }, this.$get = ["comm", "$q", "$http", "$timeout", "commTimeout", "model.state", "model.authService", "$window", "$rootScope", "$filter", function (b, c, d, e, f, g, h, i, j, k) { var l = (f.DEFAULT_TIMEOUT, f.GET_TIMEOUT, f.NOTIFICATION_TIMEOUT), m = {}, n = {}, o = {}, p = !1, q = 0, r = []; window.addEventListener("message", function (b) { var c = b.data.sid, d = b.data.model, e = b.data.gid; if (b.stopPropagation(), b.source === window && c && d && angular.isDefined(e)) { var f = o[c]; if (f) { for (var g in n) { var h = _.find(n[g].scopeBackendSubscriptions, { id: f.$id }); if (h && h.linkedTo) { var i = d[g] ? d[g][0] : null; if (i) { var j = h.linkedTo, l = h.options && h.options.reverseLink ? h.options.reverseLink : null; for (var m in d[g]) { var p = d[g][m]; p ? A(p, d, g, j, l) : console.error('while linking, element of "' + g + '" is undefined') } } } } angular.forEach(d, function (b, c) { if (angular.isDefined(a[c])) { var e = _.find(n[c].scopeBackendSubscriptions, { id: f.$id }); e && (d[c] = k(a[c])(b)) } }), f.m = d; for (var q in f.m) f[q] = f.m[q]; f.$emit("model:updated"), f.$apply() } angular.isDefined(e) && angular.isDefined(r[e]) && r[e].pending--, angular.isDefined(e) && r[e] && 0 == r[e].pending && (r[e].deferred.resolve(), delete r[e]) } }); var s = null, t = null, u = function (a) { if (null !== s); else { var b = q++; r[b] = { pending: 0, deferred: c.defer() }, t = r[b].deferred.promise, s = e(function () { s = null; for (var c in o) { var d = o[c]; if (a || d.$modelMeta && d.$modelMeta[c] && d.$modelMeta[c].pendingSubscription) { var e = !0; for (var f in n) { var g = n[f]; if (g) { var h = _.find(g.scopeBackendSubscriptions, { id: d.$id }), i = angular.isDefined(m[f]), j = i || !h; e &= j } } e && (d.$modelMeta[c].pendingSubscription = !1, window.postMessage({ sid: c, model: m, gid: b }, "*"), r[b].pending++) } } 0 == r[b].pending && (r[b].deferred.resolve(), delete r[b]) }, 60) } return t }, v = function (a) { var b = {}; a && a.links && (b.links = a.links); for (var c in a) if ("$$hashKey" !== c) { var d = a[c]; if ("links" !== c) if (d instanceof Array) { b[c] = []; for (var e in d) { var f = d[e]; "object" != typeof f ? (angular.isDefined(b[c]) || (b[c] = []), b[c][e] = d[e]) : angular.isDefined(a.links) && angular.isDefined(a.links[e]) && (angular.isDefined(b.links) || (b.links = {}), angular.isDefined(b.links[c]) || (b.links[c] = []), b.links[c][e] = f.id) } } else d && "object" == typeof d ? (angular.isDefined(b.links) || (b.links = {}), b.links[c] = d.id) : b[c] = d } return b }, w = function (a, b) { var c = n[a]; if (c) for (var d in c.scopeBackendSubscriptions) { var e = c.scopeBackendSubscriptions[d], f = e.linkedTo, g = e.options && e.options.reverseLink ? e.options.reverseLink : null, h = e.scope.m; x(h, a, f, g, b), e.scope.$emit("model:updated", { backend: a, id: b, action: "removed" }) } x(m, a, c.linkedTo, c.reverseLink, b) }, x = function (a, b, c, d, e) { var f = a[b]; if (f) { var g = _.findIndex(f, { id: e }); if (0 > g) console.log("element not found while trying to remove it from backend " + b); else { var g = _.findIndex(f, { id: e }), h = f[g]; for (var i in c) if (h.links && (h.links[i], c[i], d && d[i])) { var j = d[i], k = h[i]; if (angular.isDefined(k)) { var l = k[j]; if (l instanceof Array) { var m = _.findIndex(l, { id: e }); m >= 0 && l.splice(m, 1) } else l && l.id === e && delete containerBackend[j] } else console.warn("While removing element the reverseLink target is not defined!") } f.splice(g, 1) } } }, y = function (b, c, d) { var e = n[b]; if (e) { d && j.$emit("model:updated", { backend: b, id: c.id, action: "updated" }); for (var f in e.scopeBackendSubscriptions) { var g = e.scopeBackendSubscriptions[f], h = g.linkedTo, i = g.options && g.options.reverseLink ? g.options.reverseLink : null, l = g.scope.m; l && (z(l, b, h, i, c), d && (angular.isDefined(a[b]) && (l[b] = k(a[b])(l[b])), g.scope.$emit("model:updated", { backend: b, id: c.id, action: "updated" }))) } } z(m, b, e.linkedTo, e.reverseLink, c) }, z = function (a, b, c, d, e) { var f = a[b]; if (f) { var g = _.cloneDeep(e), h = _.findIndex(f, { id: e.id }); if (0 > h) f.push(g); else { var i = f[h]; for (var j in i.links) { var k = i[j]; e.links && k && k.id != e.links[j] && d && d[j] && k[d[j]] && (k[d[j]] instanceof Array ? k[d[j]].splice(k[d[j]].indexOf(i), 1) : delete k[d[j]], delete i[j]) } for (var l in g) if ("links" != l) i[l] = g[l]; else { i.links || (i.links = {}); for (var n in g.links) i.links[n] = g.links[n] } g = i } a != m && A(g, a, b, c, d) } else console.error("Somebody requested to updateElement into backend " + b + " but this backend doesn't exist on the target scope!") }, A = function (a, b, c, d, e) { for (var f in d) if (a.links) { var g = a.links[f]; if (g) { var h = d[f], i = b[h]; if (angular.isArray(g)) { var j = []; for (var k in g) { var l = _.find(i, { id: g[k] }); l ? (e && e[f] && (l[e[f]] = a), j.push(l)) : console.warn(c + " hasMay " + h + " but target " + g[k] + " does not exist") } a[f] = j } else if (angular.isDefined(i)) { var l = _.find(i, { id: g }); if (angular.isDefined(l) && e && e[f]) { l[e[f]] || (l[e[f]] = []); var m = l[e[f]], n = _.findIndex(m, { id: a.id }); n >= 0 ? m[n] = a : m.push(a) } a[f] = l, l || console.warn(c + " hasOne  " + f + " but target " + g + "does not exist") } } } else a.links || console.warn('while linking, element of "' + c + '" backend does not have links property') }, B = function () { var a = !1, d = !1, f = [], h = null, j = b.resource("subscriptions"), k = function () { var a = []; for (var b in f) { var c = f[b].name; a.indexOf(c) < 0 && a.push(c) } return a }; angular.element(i).on("beforeunload", function () { p = !0 }); var n = null, o = function () { var a = k(); if (p) { var b = c.defer(); return b.reject(), b.promise } if (h && h.id) { if (a.toString() === h.backends.toString()) { var b = c.defer(); return b.resolve(), b.promise } if (null == n) return n = j.update({ id: h.id, backends: a }, !0).then(function (a) { p || (h = a[0], n = null) }, function (a) { return p ? void 0 : (h = null, n = null, console.error("Error updating model subscriptions"), stop(), e(function () { console.warn("Retrying connection with BLGW"), r(), g.setStateConnecting("Retrying connection...") }, 5e3), c.reject(a)) }); var b = c.defer(); return n.then(function () { p || h && h.id && h.backends == k() || o().then(function () { b.resolve() }, function () { b.reject() }) }, function () { b.reject() }), b.promise } if (null != n) { var b = c.defer(); return n.then(function () { p || h && h.id && h.backends == k() || o().then(function () { b.resolve() }, function () { b.reject() }) }, function () { b.reject() }), b.promise } return g.setStateConnecting("Connecting with BLGW..."), n = j.add({ backends: a }, !0).then(function (a) { return g.setStateConnected("Connected."), h = a[0], n = null, a }, function (a) { if (!p) { if (n = null, 408 == a.status) { var b = "BLGW is busy", d = 5e3; a.data && a.data.state && ("loading" == a.data.state ? b = "BLGW is loading configuration" : "saving" == a.data.state ? b = "BLGW is saving configuration" : "swupdate" == a.data.state ? (b = "BLGW is flashing", d = 1e3) : "reboot" == a.data.state ? (b = "BLGW will reboot, this could take several minutes", d = 12e4) : b = "BLGW is busy (" + a.data.state + ")"), g.setStateHagwBusy(b + ", please wait."), e(function () { r(), g.setStateConnecting(b + ", please wait.") }, d) } else 503 == a.status || 500 == a.status ? g.setStateError("BLGW is not ready to accept connections (" + a.status + "), we will retry in 5 seconds.") : g.setStateError("Error while connecting to BLGW (" + a.status + "), please check network state."), e(function () { r(), g.setStateConnecting("Retrying connection...") }, 5e3); return c.reject(a) } }) }, q = function () { !p && h && h.id ? j.execute("notifications", h.id, void 0, !0, l).then(function (b) { if (d || p) a = !1, h = null; else { if (g.isBusy() && g.setStateConnected(), angular.isDefined(b)) { if (g.startProcessingRequest("Model update...", !0), angular.isDefined(b.updated)) { var c = b.updated, i = []; for (var j in c) { var k = c[j], l = j; for (var n in f) if (f[n].name === l && f[n].update_cb) for (var o in k) { var r = k[o], s = _.find(m[l], { id: r.id }); i[l] || (i[l] = []), i[l][r.id] = !_.isEqual(r, s), i[l][r.id] ? f[n].update_cb(l, r) : console.warn("Notification received on " + l + ".id = " + r.id + " but element does not changed, ignoring...") } } for (var j in c) { var k = c[j], l = j; for (var n in f) if (f[n].name === l && f[n].update_cb) for (var o in k) { var r = k[o]; i[l][r.id] && f[n].update_cb === y && y(l, r, !0) } } } if (angular.isDefined(b.deleted)) for (var l in b.deleted) { var t = b.deleted[l]; for (var u in t) for (var n in f) f[n].name === l && f[n].deleted_cb && f[n].deleted_cb(l, t[u]) } g.finishProcessingRequest("Model update...") } e(q, 500) } }, function (b) { if (d || p) a = !1, h = null; else if (404 == b.status) console.warn("Our subscription is not longer valid, restarting monitoring notifications subscription"), a = !1, h = null, r(), g.setStateConnecting("Synchronizing with BLGW..."); else if (408 == b.status) { var c = "BLGW is busy", f = 2e3; b.data && b.data.state && ("loading" == b.data.state ? c = "BLGW is loading configuration" : "saving" == b.data.state ? c = "BLGW is saving configuration" : "swupdate" == b.data.state ? (c = "BLGW is flashing", f = 1e3) : "reboot" == b.data.state ? (c = "BLGW will reboot, this could take several minutes", f = 12e4) : c = "BLGW is busy (" + b.data.state + ")"), g.setStateHagwBusy(c + ", please wait."), e(q, f) } else 503 == b.status || 500 == b.status ? (g.setStateError("BLGW is not ready to accept connections (" + b.status + "), we will retry in 5 seconds."), e(function () { r() }, 5e3), a = !1, h = null) : e(function () { p || (g.setStateError("Communication error (" + b.status + ") with BLGW, we will retry in 5 seconds. Please check network connection."), e(function () { r() }, 5e3), a = !1, h = null) }, 0) }) : console.warn("modelService: Somebody requested to update notificactions but modelSubscriptions is not defined") }, r = function () { return a && t(), o().then(function () { s(), H(!0) }) }, s = function () { a || (a = !0, d = !1, q()) }, t = function () { a && (h = null, d = !0) }; return { addBackend: function (a, b, c) { var d = { name: a, update_cb: b, deleted_cb: c }, e = f.indexOf(d); return 0 > e && f.push(d), function () { var a = f.indexOf(d); a >= 0 && f.splice(a, 1) } }, sync: function () { return a ? o() : o().then(s) } } }, C = B(), D = function (a, b, c) { return { id: a.$id, scope: a, linkedTo: b, options: c } }, E = function (a) { return C.addBackend(a, y, w), { id: a, linkedTo: {}, reverseLink: {}, recomputeRequired: !0, scopeBackendSubscriptions: [], computeLinks: function () { if (this.recomputeRequired) { var a = this.linkedTo, b = this.reverseLink, c = this; this.recomputeRequired = !1, this.linkedTo = {}, this.reverseLink = {}; for (var d in this.scopeBackendSubscriptions) { var e = this.scopeBackendSubscriptions[d]; for (var f in e.linkedTo) this.linkedTo[f] = e.linkedTo[f], e.options && e.options.reverseLink && e.options.reverseLink[f] && (this.reverseLink[f] = e.options.reverseLink[f]) } var g = { linkedTo: {}, reverseLink: {} }; return a && angular.forEach(a, function (a, b) { c.linkedTo && c.linkedTo[b] && c.linkedTo[b] === a || (g.linkedTo[b] = a) }), b && angular.forEach(b, function (a, b) { c.reverseLink && c.reverseLink[b] && c.reverseLink[b] === a || (g.reverseLink[b] = a) }), angular.toJson(b) === angular.toJson(this.reverseLink) || angular.toJson(this.linkedTo) === angular.toJson(this.linkedTo) ? g : null } return null }, removeScopeSubscription: function (a) { var b = _.find(this.scopeBackendSubscriptions, { id: a.$id }); b && (this.scopeBackendSubscriptions.splice(this.scopeBackendSubscriptions.indexOf(b), 1), this.recomputeRequired = !0) }, addScopeSubscription: function (a) { _.findIndex(this.scopeBackendSubscriptions, { id: a.id }) < 0 && (this.recomputeRequired = !0, this.scopeBackendSubscriptions.push(a)) } } }, F = [], G = function (a, d) { var e = ((new Date).getTime(), ""), f = 0; g.startProcessingRequest("Loading...", !0); for (var h in n) { var i = n[h]; e += h + " "; var j = i.options && i.options.alwaysLoad ? i.options.alwaysLoad : !1; if (!angular.isDefined(m[h]) || d || j) { m[h] = void 0; var k = function (a) { f++; var c = b.resource(a).get().then(function (b) { m[a] = b, f--, F.splice(F.indexOf(c), 1) }, function (b) { angular.isDefined(p) && p || (console.error('Errow downloading "' + a + '": ' + b.toString()), g.setStateError('Error downloading "' + a + '" data from BLGW, please check network state and try refreshing this page. If the problem persists contact B&O service (' + b.status + ").")) }); F.push(c) }; k(h) } } F.length > 0 ? c.all(F).then(function () { 0 !== f && console.warn("Something quite strange is happening, promise was resolved but not all downloadPromises returned"), console.warn("The following backends has been downloaded: " + e), u(d).then(function () { g.finishProcessingRequest("Loading..."), a.resolve() }) }, function () { a.reject() }) : u(d).then(function () { g.finishProcessingRequest("Loading..."), a.resolve() }) }, H = function (a) { var b = c.defer(); return 9e3 == window.location.port ? G(b, a) : C.sync().then(function () { G(b, a) }), b.promise }; return { subscribe: function (a, b, c, d) { var e = n[b], f = a.$id; a.$modelMeta || (a.$modelMeta = {}), a.$modelMeta[f] || (a.$modelMeta[f] = {}), a.$modelMeta[f].pendingSubscription = !0, a[b] = [], angular.isDefined(e) || (e = E(b), n[b] = e), e.addScopeSubscription(D(a, c, d)), o[f] || (o[f] = a, a.$on("$destroy", function (b) { if (b.currentScope === a) { for (var c in n) n[c].removeScopeSubscription(a); angular.isDefined(o[f]) && delete o[f] } })) }, realtimeSubscribe: function (a, b, c, d) { var e = C.addBackend(b, c, d); C.sync(); var f = a.$on("$destroy", function (b) { b.targetScope === a && (e(), C.sync()) }); return function () { f(), e(), C.sync() } }, load: function (a) { return H(a) }, add: function (a, d) { var e = "Adding element...", f = c.defer(); return g.startProcessingRequest(e, !1), b.resource(a).add(v(d)).then(function (b) { var c = _.find(m[a], { id: b[0].id }); if (c) g.finishProcessingRequest(e), f.resolve(b[0]); else var d = j.$on("model:updated", function (c, h) { h.backend == a && b[0].id == h.id && (g.finishProcessingRequest(e), _.find(m[a], { id: b[0].id }), f.resolve(b[0]), d()) }) }, function (a) { g.finishProcessingRequest(e), f.reject(a) }), f.promise }, remove: function (a, d, e) { var f = c.defer(), h = "Removing element..."; return g.startProcessingRequest(h, !1), b.resource(a).remove(d, e).then(function (b) { g.finishProcessingRequest(h), w(a, d.id), f.resolve(b) }, function (a) { g.finishProcessingRequest(h), f.reject(a) }), f.promise }, update: function (a, d, e) { var f = "Updating element..."; return g.startProcessingRequest(f, !1), b.resource(a).update(v(d), e).then(function (a) { return g.finishProcessingRequest(f), a }, function (a) { return g.finishProcessingRequest(f), c.reject(a) }) }, execute: function (a, d, e, f, h, i) { var j = "Executing..."; return g.startProcessingRequest(j, !1), b.resource(a).execute(d, e, f, h, i).then(function (a) { return g.finishProcessingRequest(j), a }, function (a) { return g.finishProcessingRequest(j), c.reject(a) }) }, serialazableElement: v, state: g, getState: g.getState, getStateDescription: g.getDescription, isConnected: g.isConnected, isProcessing: g.isProcessing, isLocked: g.isLocked, authService: h } }] }), model.factory("comm", ["$http", "$q", "commTimeout", function ($http, $q, commTimeout) { var DEFAULT_TIMEOUT = commTimeout.DEFAULT_TIMEOUT, EXECUTE_TIMEOUT = commTimeout.EXECUTE_TIMEOUT, GET_TIMEOUT = commTimeout.GET_TIMEOUT; return { resource: function (resourceName) { return { get: function (a, b) { var c = { timeout: GET_TIMEOUT, params: a }; return $http.get("/a/model/" + resourceName, c).then(function (a) { return a.data[resourceName] }, function (a) { return console.error('Error loading "' + resourceName + '"'), $q.reject(a) }) }, execute: function (a, b, c, d, e) { var f = { timeout: EXECUTE_TIMEOUT }, g = ""; return angular.isDefined(b) && (g = b + "/"), angular.isDefined(c) ? (f.data = c, f.method = "POST") : f.method = "GET", angular.isDefined(e) && (f.timeout = e), f.url = "/a/model/" + resourceName + "/" + g + a, $http(f).then(function (a) { return a.data }, function (c) { return console.error('Error executing method "' + a + '" on "' + resourceName + "[" + b + "]"), 404 != c.status && (angular.isDefined(d) && d || alertify.error('Error: "' + c.data.message + '" (' + c.status + ")")), $q.reject(c) }) }, getProperty: function (a, b, c) { var d = { timeout: DEFAULT_TIMEOUT }; return $http.get("/a/model/" + resourceName + "/" + a + "/" + b, d).then(function (a) { return angular.isDefined(c) && c || alertify.log("Done loading " + resourceName + "!"), a.data[b] }, function (d) { return console.error('Error getting property "' + b + '" of ' + resourceName + "[" + a + "]"), angular.isDefined(c) && c || alertify.error("Error loading property" + resourceName + ': "' + d.data.message + '"'), $q.reject(d) }) }, add: function (element, quiet) { var config = { timeout: DEFAULT_TIMEOUT }; return $http.post("/a/model/" + resourceName, element, config).then(function (response) { return eval("response.data." + resourceName) }, function (a) { return console.error("Error adding " + resourceName + " " + element.id), console.error(a), angular.isDefined(quiet) && quiet || alertify.error("Error adding: " + formatError(a, resourceName)), $q.reject(a) }) }, remove: function (a, b) { var c = { timeout: DEFAULT_TIMEOUT }; return $http["delete"]("/a/model/" + resourceName + "/" + a.id, c).then(function (a, c, d, e) { return angular.isDefined(b) && b || alertify.log("" + resourceName + " deleted!"), c }, function (c) { return console.error("Error deleting " + resourceName + " " + a.id), console.error(c), angular.isDefined(b) && b || alertify.error("Error deleting: " + formatError(c, resourceName)), $q.reject(c) }) }, update: function (a, b) { var c = { timeout: DEFAULT_TIMEOUT }; return $http.put("/a/model/" + resourceName + "/" + a.id, a, c).then(function (a) { return a.data[resourceName] }, function (c) { return console.error("Error updating:" + resourceName + " " + a.id), console.error(c), angular.isDefined(b) && b || alertify.error("Error updating: " + formatError(c, resourceName)), $q.reject(c) }) } } } } }]), model.factory("model.authService", ["$rootScope", "$injector", "$location", "$cookies", "model.httpBuffer", "base64_encode", function (a, b, c, d, e, f) { var g, h = void 0, i = new RegExp("^([0-9]+),(admin|manager|common),(.*)"), j = { fromCookie: !1, isAdmin: !1, username: "", usertype: "common", complete: "" }, k = function () { return "X-Basic " + f(m.user + ":" + h) }, l = function (a) { return e.isModelRequest(a) && (a.headers.Authorization = k()), a }, m = { user: void 0, logged: !0, termsApprovalRequired: !1, isAdmin: function () { var a = null; return this.logged && (a = j.isAdmin), a }, getUserType: function () { var a = null; return this.logged && (a = j.usertype), a }, getUsername: function () { var a = null; return this.logged && (a = j.username), a }, loginConfirmed: function (b, c, d) { this.user = c, h = d, a.$broadcast("model:loginConfirmed", b), e.retryAll(l), n() }, termsAccepted: function () { a.$broadcast("model:termsApprovalAccepted"), m.termsApprovalRequired = !1, e.retryAll(l) }, loginCancelled: function (b, c) { e.rejectAll(c), a.$broadcast("model:loginCancelled", b) }, logout: function () { this.user = null, h = null, g = g || b.get("$http"), g.get("/a/logout").then(function () { window.location.reload() }) }, getAuthorizationString: k }, n = function () { var a = d.get("whoami"); if (angular.isDefined(a)) { var b = _.cloneDeep(j), c = a.match(i); c && c.length > 2 ? (j.username = c[3], j.usertype = c[2], j.isAdmin = "admin" == c[2]) : (j.username = "", j.usertype = "", j.isAdmin = !1, console.warn("whoami cookie is not valid!")), j.fromCookie = !0, j.source = a, m.logged && (m.user && m.user.length > 0 && j.username != m.user || b && b.source && b.source.length > 0 && b.fromCookie && b.source != a) ? window.location.reload() : m.user && 0 != m.user.length || (m.user = j.username) } else j.fromCookie = !1, j.isAdmin = "admin" == m.user, j.username = m.user, j.usertype = "admin" == m.user ? "admin" : "common" }; return a.$watch(function () { return d.get("whoami") }, n), n(), m }]), model.config(["$httpProvider", function (a) { a.interceptors.push(["$rootScope", "$q", "model.httpBuffer", "model.authService", "model.state", function (a, b, c, d, e) { return { request: function (a) { return c.isModelRequest(a) && c.reqTransformer && (a = c.reqTransformer(a)), a || b.when(a) }, response: function (e) { return !d.logged && c.isModelRequest(e.config) && (d.logged = !0, d.termsApprovalRequired && (d.termsApprovalRequired = !1, a.$broadcast("model:termsApprovalAccepted")), a.$broadcast("model:loginOk", e)), e || b.when(e) }, responseError: function (e) { if (c.isModelRequest(e.config)) { if (401 === e.status) { var f = b.defer(); return d.logged = !1, c.append(e.config, f), a.$broadcast("model:loginRequired", e), f.promise } if (451 === e.status) { var f = b.defer(); return d.termsApprovalRequired = !0, d.logged = !0, c.append(e.config, f), a.$broadcast("model:termsApprovalRequired"), console.log("Terms should be approved"), f.promise } } return b.reject(e) } } }]) }]), model.factory("model.httpBuffer", ["$injector", function (a) { function b(b, d) { function e(a) { d.resolve(a) } function f(a) { d.reject(a) } c = c || a.get("$http"), c(b).then(e, f) } var c, d = []; return { reqTransformer: null, isModelRequest: function (a) { return 0 === a.url.indexOf("/a/") }, append: function (a, b) { d.push({ config: a, deferred: b }) }, rejectAll: function (a) { if (a) for (var b = 0; b < d.length; ++b)d[b].deferred.reject(a); d = [] }, retryAll: function (a) { this.reqTransformer = a; for (var c = 0; c < d.length; ++c)b(this.reqTransformer(d[c].config), d[c].deferred); d = [] }, removeTransformer: function () { this.reqTransformer = null } } }]), model.factory("model.state", ["$rootScope", function (a) { var b = { 1: "BLGW is busy", 2: "Error", 10: "Initializing", 11: "Connecting", 20: "Connected", 22: "Processing request" }, c = 10, d = 1, e = "Initializing...", f = {}, g = function (a, d) { c = a, e = d, 2 === c && console.error(" STATE: " + b[c] + " -> " + d) }, h = function () { var a = { d: "", c: 0 }, b = !1; for (var c in f) { var e = f[c]; e >= a.c && (a = { d: c, c: e.counter }), b |= e.shouldLock } i.isConnected() && (a.c > 0 ? (g(22, a.d), d = b) : (g(20, ""), d = !1)) }, i = { stateEnum: b, setStateError: function (a) { g(2, a) }, setStateHagwBusy: function (a) { g(1, a) }, setStateInitializing: function (a) { g(10, a) }, setStateConnecting: function (a) { this.processingList = {}, g(11, a) }, setStateConnected: function (a) { g(20, a), h() }, startProcessingRequest: function (a, b) { var c = { counter: 0, shouldLock: !1 }; angular.isDefined(f[a]) && (c = f[a]), c.counter++, c.shouldLock |= b, f[a] = c, this.isConnected() && g(22, a) }, finishProcessingRequest: function (a) { angular.isDefined(f[a]) && (f[a] > 1 ? f[a]-- : delete f[a], h()) }, isAuthRequired: function () { return 3 == c }, isConnected: function () { return c >= 20 }, isLocked: function () { return 11 == c || 10 == c || 1 == c || 22 == c && d }, isBusy: function () { return 1 == c }, isProcessing: function () { return c >= 21 || 11 == c || 10 == c || 1 == c }, getDescription: function () { return e }, getState: function () { return b[c] } }; return i }]); var ikfilters = angular.module("ikatu.filters", []); ikfilters.filter("reverse", function () { return function (a) { return a.slice().reverse() } }), ikfilters.filter("fullname", ["$rootScope", function (a) { return function (b) { var c = "", d = !0; return a.justOneArea && (d = !1), b && angular.isDefined(b) && angular.isDefined(b.name) && angular.isDefined(b.zone) && angular.isDefined(b.zone.area) ? (d && (c = b.zone.area.name + "/"), c += b.zone.name + "/" + b.name) : b && angular.isDefined(b) && angular.isDefined(b.name) && angular.isDefined(b.area) ? (d && (c = b.area.name + "/"), c += b.name) : c = b && angular.isDefined(b) && angular.isDefined(b.name) ? b.name : "", c } }]), ikfilters.filter("capitalize", function () { return function (a, b) { return null != a ? a.substring(0, 1).toUpperCase() + a.substring(1) : void 0 } }), ikfilters.filter("uncamel", function () { return function (a, b) { var c = "", d = !1, e = !1; if (null != a) { a.length > 0 && "_" == a.charAt(0) && (a = a.slice(1)); for (var f = 0; f < a.length; f++){ var g = a.charAt(f); if (" " === g) d = !0; else if (0 == f) c += g.toUpperCase(), g !== g.toLowerCase() && (e = !0); else if (g !== g.toLowerCase()) { var h = angular.isDefined(a.charAt(f + 1)) ? a.charAt(f + 1).toLowerCase() !== a.charAt(f + 1) : !1; c += e || h ? g : " " + g.toLowerCase(), e = !0 } else c += g, e = !1 } } return d ? a : c } }), ikfilters.filter("orText", function () { return function (a, b) { return a ? a : b } }), ikfilters.filter("andText", function () { return function (a, b) { return a ? a + b : a } }), ikfilters.filter("uniqueCounter", function () { return function (a, b) { var c = []; for (var d in a) { var e = a[d], f = _.findIndex(c, { prop: e[b] }); if (0 > f) { var g = {}; g[b] = e[b], g.items = [e], c.push(g) } else c[f].items.push(e) } return c } }), ikfilters.filter("isInternal", function () { return function (a, b) { return a && a.length > 0 ? !angular.isDefined(b) || b ? a.filter(function (a, b, c) { return a.internal }) : a.filter(function (a, b, c) { return !a.internal }) : a } }), ikfilters.filter("hasConnectinoState", function () { return function (a) { return a && a.length > 0 ? a.filter(function (a, b, c) { return angular.isDefined(a.state) && angular.isDefined(a.state.CONNECTION) }) : a } }), ikfilters.filter("linkedTo", function () { return function (a, b, c) { return b && a ? !c || c.length < 1 ? a : a.filter(function (a, d, e) { return a.links && a.links[b] === c }) : a } }), ikfilters.filter("startFrom", function () { return function (a, b) { return b = +b, b > 0 && a ? a.slice(b) : a } }), ikfilters.filter("ikEscapeQuote", [function () { return function (a) { return a ? a.replace(new RegExp('"', "g"), "&quot;") : a } }]), ikfilters.filter("ikHighlight", ["$sce", function (a) { return function (b, c) { return b && c ? a.trustAsHtml(b.replace(new RegExp(c, "gi"), '<span style="background:yellow">$&</span>')) : a.trustAsHtml(b) } }]), ikfilters.filter("filterGlobal", function () { return function (a, b) { return a && a.length > 0 && angular.isDefined(b) && b ? a.filter(function (a, b, c) { return !a.global }) : a } }), ikfilters.filter("absdate", ["$filter", function (a) { return function (b, c) { b = angular.isNumber(b) ? new Date(b) : new Date(parseInt(b)); var d = new Date(b.getFullYear(), b.getUTCMonth(), b.getUTCDate(), b.getUTCHours(), b.getUTCMinutes(), b.getUTCSeconds()); return a("date")(d, c) } }]), ikfilters.filter("orderInZoneArea", [function () { return function (a) { return angular.isDefined(a) && _.size(a) > 0 && angular.isDefined(a[0].zone) && angular.isDefined(a[0].zone.area) ? a.sort(function (a, b) { try { var c = {}, d = {}; if (c.aname = a.zone.area.name.toUpperCase(), d.aname = b.zone.area.name.toUpperCase(), c.zname = a.zone.name.toUpperCase(), d.zname = b.zone.name.toUpperCase(), c.name = a.name.toUpperCase(), d.name = b.name.toUpperCase(), c.aname < d.aname) return -1; if (c.aname > d.aname) return 1; if (c.zname < d.zname) return -1; if (c.zname > d.zname) return 1; if (c.name < d.name) return -1; if (c.name > d.name) return 1 } catch (e) { } return 0 }) : a } }]), ikfilters.filter("orderInArea", [function () { return function (a) { return angular.isDefined(a) && _.size(a) > 0 && angular.isDefined(a[0].area) ? a.sort(function (a, b) { try { var c = {}, d = {}; if (c.aname = a.area.name.toUpperCase(), d.aname = b.area.name.toUpperCase(), c.name = a.name.toUpperCase(), d.name = b.name.toUpperCase(), c.aname < d.aname) return -1; if (c.aname > d.aname) return 1; if (c.name < d.name) return -1; if (c.name > d.name) return 1 } catch (e) { } return 0 }) : a } }]), ikfilters.filter("orderByName", [function () { return function (a) { return angular.isDefined(a) && _.size(a) > 0 && angular.isDefined(a[0].name) ? a.sort(function (a, b) { var c = a.name.toUpperCase(), d = b.name.toUpperCase(); return d > c ? -1 : c > d ? 1 : 0 }) : a } }]), ikfilters.filter("addIfMissing", function () { return function (a, b, c, d, e) { if (!(a && b && c && d && e)) return a; if (_.findIndex(a, { keyname: d }) >= 0) return a; var f = {}; return f[b] = d, f[c] = e, a.push(f), a } }), ikfilters.filter("smartfilter", function () { return function (a, b) { if (a) { if (b && 0 != b.length && 0 != a.length) { var c, d = b.toLowerCase(), e = a[0]; return c = angular.isDefined(e.zone) && angular.isDefined(e.zone.area) && angular.isDefined(e.name) ? angular.isDefined(e.spec) && angular.isDefined(e.spec.type) && angular.isDefined(e.address) && angular.isDefined(e.spec.label) ? a.filter(function (a) { return a.name.toLowerCase().indexOf(d) > -1 || a.zone.name.toLowerCase().indexOf(d) > -1 || a.zone.area.name.toLowerCase().indexOf(d) > -1 || a.address.toString().indexOf(b) > -1 || a.spec.label.toLowerCase().indexOf(d) > -1 }) : a.filter(function (a) { return a.name.toLowerCase().indexOf(d) > -1 || a.zone.name.toLowerCase().indexOf(d) > -1 || a.zone.area.name.toLowerCase().indexOf(d) > -1 }) : angular.isDefined(e.fullname) && angular.isDefined(e.address) && angular.isDefined(e.description) ? a.filter(function (a) { return a.fullname.toLowerCase().indexOf(d) > -1 || a.address.indexOf(b) > -1 || a.description.toLowerCase().indexOf(d) > -1 || a.type.toLowerCase().indexOf(d) > -1 }) : angular.isDefined(e.name) ? a.filter(function (a) { return a.name.toLowerCase().indexOf(d) > -1 }) : a } return a } } }), ikfilters.filter("filterby", function () { return function (a, b, c) { if (a) { if (b && 0 != b.length && c && 0 != c.length && 0 != a.length) { var d = c.toLowerCase(), e = a.filter(function (a) { for (var c = !1, e = 0; !c && e < b.length;)c |= a[b[e]].toLowerCase().indexOf(d) > -1, e++; return c }); return e } return a } } }), ikfilters.filter("macrofilter", ["$filter", function (a) { return function (b, c) { var d = b; if (b && c && c.length > 0) { for (var e = "", f = [], g = c.length, h = new RegExp(/ *mode:[a-zA-Z0-9]+ *|\ *mode:"[^"]+" *| *mode:\'[^\']+\' */g), i = new RegExp(/^\ *mode:["']*/), j = new RegExp(/["']*\ *$/); g > 0;){ var k = h.exec(c); if (k && k[0]) { var l = k[0].replace(i, "").replace(j, ""), m = c.substring(c.length - g, h.lastIndex - k[0].length); f.push(l), m.length && e.length ? e += " " + m : m.length && (e = m), g = c.length - h.lastIndex } else g > 0 && (e.length && (e += " "), e += c.substring(c.length - g, c.length)), g = 0 } if (e.length && (d = a("smartfilter")(b, e)), f.length) { var n = d.filter(function (a) { var b = !0; return angular.forEach(f, function (c) { var d = c.toLowerCase(); if (a.modes && 0 != a.modes.length) { var e = !1; angular.forEach(a.modes, function (a) { e = e || d == a.name.toLowerCase() }), b &= e } else b &= !0 }), b }); d = n } } return d } }]); var utils = angular.module("hagw.utils", []); utils.factory("base64_encode", function () { return function (a) { var b, c, d, e, f, g, h, i, j = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", k = 0, l = 0, m = "", n = []; if (!a) return a; do b = a.charCodeAt(k++), c = a.charCodeAt(k++), d = a.charCodeAt(k++), i = b << 16 | c << 8 | d, e = i >> 18 & 63, f = i >> 12 & 63, g = i >> 6 & 63, h = 63 & i, n[l++] = j.charAt(e) + j.charAt(f) + j.charAt(g) + j.charAt(h); while (k < a.length); m = n.join(""); var o = a.length % 3; return (o ? m.slice(0, o - 3) : m) + "===".slice(o || 3) } }), parseUri.options = { strictMode: !1, key: ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"], q: { name: "queryKey", parser: /(?:^|&)([^&=]*)=?([^&]*)/g }, parser: { strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/, loose: /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/ } }; var queryToParams = function (a) { a = a.substring(a.indexOf("?") + 1).split("&"); for (var b, c = {}, d = decodeURIComponent, e = a.length - 1; e >= 0; e--)b = a[e].split("="), c[d(b[0])] = d(b[1]); return c }, myDirectives = angular.module("ik.directives", []).directive("ngSetFocus", ["$timeout", function (a) { return function (b, c, d) { var e = b.$watch(d.ngSetFocus, function (b) { b && a(function () { c[0].focus() }, 0, !1) }); b.$on("$destroy", function () { e() }) } }]).directive("ngSetBlur", ["$timeout", function (a) { return function (b, c, d) { var e = b.$watch(d.ngSetBlur, function (d) { d && a(function () { c[0].blur() }, 0, !1), b.$on("$destroy", function () { e() }) }) } }]).directive("ikFocusOn", ["$timeout", function (a) { return function (b, c, d) { var e = b.$watch(d.ikFocusOn, function (d) { d && a(function () { c[0].focus(), c[0].select() }, 0, !1), b.$on("$destroy", function () { e() }) }) } }]).directive("player", ["$window", function (a) { return { link: function (b, c, d) { var e = "/ixp_data/tvpanel_background.mp4"; b.pop = Popcorn.smart(c[0].id, e), b.pop.play(), b.pop.controls(!1), b.pop.loop(!0); var f = function (a) { switch (a.keyCode) { case VK_PAUSE: case BK_PAUSE: case VK_STOP: case BK_STOP: b.pop.pause(), a.preventDefault(); break; case VK_PLAY: case BK_PLAY: b.pop.play(), a.preventDefault() } }; angular.element(a).on("keydown", f), c.on("$destroy", function () { angular.element(a).off("keydown", f) }) } } }]).directive("ikSetMaxHeight", ["$window", "$rootScope", function (a, b) { return { link: function (b, c, d) { var e = function () { b.$eval(d.autoResize) ? c.css("min-height", "") : c.css("min-height", a.innerHeight - 52 + "px") }; e(), angular.element(a).on("resize", e), c.on("$destroy", function () { angular.element(a).off("resize", e) }) } } }]).directive("ikEqualHeight", ["$window", function (a) {
var b=[];return{compile:function(c,d){return b.push(c),console.warn("elementList.length: "+b.length),function(d,e,f){var g=function(){var c=a.innerHeight;for(var d in b)b[d].css("min-height","0px");for(var d in b){var e=b[d][0].offsetHeight;e>c&&(c=e)}for(var d in b)b[d].css("min-height",c+"px")},h=d.$watch(function(){var a=c.css("min-height");c.css("min-height",0);var b=c[0].offsetHeight;return c.css("min-height",a),b},g);angular.element(a).on("resize",g);var i=function(){h(),angular.element(a).off("resize",g)};d.$on("$destroy",i),e.on("$destroy",i)}}}}]).directive("cameraSize",["$window",function(a){return function(b,c,d){var e=function(){var a=sizeCameraDynamic();c.css("height",a+"px");var b=c[0];b&&b.childNodes.length>0&&(b.childNodes[0].height=a,b.childNodes.length>2&&(b.childNodes[1].height=a))};e(),angular.element(a).on("resize",e),c.on("$destroy",function(){angular.element(a).off("resize",e)})}}]).directive("cameraPadding",["$window",function(a){return function(b,c,d){var e=function(){var a=sizeCameraDynamic(),b=(62-(10+a)%62)%62;c.parent().css("padding-bottom",b+"px")};e(),angular.element(a).on("resize",e),c.on("$destroy",function(){angular.element(a).off("resize",e)})}}]);angular.forEach("Focusin Focusout".split(" "),function(a){var b="ik"+a;myDirectives.directive(b,["$parse",function(c){return{restrict:"A",compile:function(d,e){var f=c(e[b]);return function(b,c){c.attr("tabindex")||c.attr("tabindex",0),c.on(angular.lowercase(a),function(a){b.$apply(function(){f(b,{$event:a})})})}}}}])}),angular.forEach("Focusin Focusout".split(" "),function(a){var b="ik"+a+"Class";myDirectives.directive(b,["$parse",function(c){return{restrict:"A",compile:function(c,d){var e=d[b];return function(b,c){c.attr("tabindex")||c.attr("tabindex",0);var d=function(b,d){b.target,eventType=b.type,b.type==angular.lowercase(a)?c.hasClass(e)||c.addClass(e):"focus"!=b.type&&c.removeClass(e)};c.on("focusin focusout",d)}}}}])}),angular.module("ik.lib.directives",[]).directive("ikColor",["$timeout","$parse",function(a,b){var c=null,d=null,e=new Image;e.src="/common/img/colorwheel.png";var f=function(){if(!c){c={},c.elem=angular.element("<span style='position:fixed; z-index:99999; top:0; bottom:0; left:0; right:0; background: transparent; user-select: none;-webkit-user-select: none;'/>"),c.frameElem=angular.element("<span style='position: fixed; top: 50%; left: 50%; margin-left: -165px; margin-top: -200px; width: 330px; height: 365px; background: rgba(10,10,10,.9);'/>"),c.titleElem=angular.element("<h1 style='position: fixed; top: 50%; left: 50%; margin-left: -160px; margin-top: -200px; width: 320px; height: 32px; text-align: center; color: #666'/>"),c.wheelElem=angular.element("<canvas width='320' height='320' style='position: fixed; top: 50%; left: 50%; margin-left: -160px; margin-top: -160px'></canvas>"),c.colorElem=angular.element("<div style='position: fixed; top: 50%; left: 50%; margin-left: -160px; margin-top: -196px; width: 32px; height: 32px; border-radius: 64px; '/>"),c.elem.append(c.frameElem),c.elem.append(c.titleElem),c.elem.append(c.colorElem),c.elem.append(c.wheelElem),c.hide=function(){c.elem.remove(),d=null},c.show=function(a,b,e,f){b?c.titleElem.html(b):c.titleElem.html(""),d=f,angular.element(document.body).append(c.elem);var g,h=a&&a.match(/^(hs.*)(,[0-9%]*\))/);if(!h||h.length<3){var i=tinycolor(a).toHsvString();h=i.match(/^(hs.*)(, [0-9%]*\))/)}e?(c.keepBright=!0,c.bright=h[2]):c.keepBright=!1,g=tinycolor(h[1]+",100)"),c.colorElem.css("background",g.toRgbString()),c.draw(),c.lastPosition=c.getColorPosition(g),c.draw(c.lastPosition),c.wheelElem.on("click",c.handleMouse),document.addEventListener("keydown",c.handleKeypress,!0),c.wheelElem.on("$destroy",function(){c.wheelElem.off("click",c.handleMouse),document.removeEventListener("keydown",c.handleKeypress,!0)}),c.elem.on("click",c.hide)},c.draw=function(a){var b=c.wheelElem[0],d=!0;c.data&&c.data.width==b.width&&c.data.height==b.height||(d=!1,c.data={},c.data.width=b.width,c.data.height=b.height,c.data.maxradius=Math.min(c.data.width,c.data.height)/2,c.data.margin=5,c.data.radius=c.data.maxradius-c.data.margin),d&&c.data.canvas&&c.data.canvas==b||(c.data.canvas=b,c.data.context=c.data.canvas.getContext("2d"));var f=c.data,g=f.context;if(d)g.putImageData(c.data.cacheImageData,0,0);else if(f.width===f.height===320)g.clearRect(0,0,b.width,b.height),g.drawImage(e,0,0),c.data.cacheImageData=f.context.getImageData(0,0,f.width,f.height).data;else{var h,i,j,k,l,m,n,o,p,q,r,s,t=255,u=0,v=f.width/2,w=f.height/2;g.clearRect(0,0,b.width,b.height),g.drawImage(e,0,0);var x=g.createImageData(f.width,f.height),y=x.data;for(k=0;k<f.height;k+=1)for(j=0;j<f.width;j+=1,u+=4)l=j-v,m=k-w,n=l*l+m*m,n<Math.pow(f.maxradius,2)?(h=6*(Math.atan2(m,l)+Math.PI)/(2*Math.PI),i=Math.min(1,Math.sqrt(n)/f.radius),p=Math.floor(h),y[u]=0,y[u+1]=0,y[u+2]=0,o=h-p,q=t*(1-i),r=t*(1-i*o),s=t*(1-i*(1-o)),y[u]=[t,r,q,q,s,t,t][p],y[u+1]=[s,t,t,r,q,q,s][p],y[u+2]=[q,q,s,t,t,r,q][p],n<Math.pow(f.radius,2)?y[u+3]=255:y[u+3]=(f.radius+2-Math.sqrt(n))/2*240):(y[u]=255,y[u+1]=255,y[u+2]=255,y[u+3]=0);g.putImageData(x,0,0),c.data.cacheImageData=x}angular.isDefined(a)&&(g.beginPath(),g.arc(a.x,a.y,5,0,2*Math.PI),g.lineWidth=2,g.strokeStyle="black",g.stroke())},c.handleMouse=function(a){a.preventDefault(),a.stopPropagation();var b=c.wheelElem[0].getBoundingClientRect(),d=Math.floor(a.pageX-b.left-window.pageXOffset),e=Math.floor(a.pageY-b.top-window.pageYOffset);c.handleSelect(d,e)};var a={ts:0,action:"",repeat:0},b=function(b){var c=1,d=(new Date).getTime();return a.ts&&a.ts+400>d&&a.action==b?(a.repeat++,c=Math.min(a.repeat,5)):(a.repeat=0,a.action=b),a.ts=d,c};c.handleKeypress=function(a){var d=0,e=0,f=4;switch(a.keyCode){case 117:case VK_UP:d+=f*b("up");break;case VK_DOWN:case 106:d-=f*b("down");break;case VK_LEFT:case 104:e+=f*b("left");break;case 107:case VK_RIGHT:e-=f*b("right")}if(d||e){a.preventDefault(),a.stopPropagation();var d,g=-e,h=-d,i={x:c.lastPosition.x,y:c.lastPosition.y},j=c.data,k=j.width/2,l=j.height/2;0!==g?(i.x=c.lastPosition.x+g,d=Math.sqrt(Math.pow(i.x-k,2)+Math.pow(i.y-l,2)),d>j.radius-2&&(i.x=k+g/Math.abs(g)*Math.sqrt(Math.pow(j.radius-2,2)-Math.pow(i.y-l,2)))):0!==h&&(i.y=c.lastPosition.y+h,d=Math.sqrt(Math.pow(i.x-k,2)+Math.pow(i.y-l,2)),d>j.radius-2&&(i.y=l+h/Math.abs(h)*Math.sqrt(Math.pow(j.radius-2,2)-Math.pow(i.x-k,2)))),c.handleSelect(i.x,i.y)}},c.getColorPosition=function(a){var b,d,e,f,g,h=c.data,i=tinycolor(a).toHsv(),j=tinycolor("hsv("+i.h+","+i.s+",100)").toRgb(),k={x:h.width/2,y:h.height/2},l=999,m=0,n={};for(h.cacheImageData&&h.cacheImageData.data?g=h.cacheImageData.data:console.error("getColorPosition: precondition: picker.data.cacheImageData show exist, call picker.draw() in order to create it"),d=0;d<h.height;d+=1)for(b=0;b<h.width;b+=1)if(e=4*(b+d*h.width),m>0)m--;else if(g[e+3]>0)if(n={r:g[e+0],g:g[e+1],b:g[e+2]},f=Math.pow(j.r-n.r,2)+Math.pow(j.g-n.g,2)+Math.pow(j.b-n.b,2),l>f){if(l=f,k={x:b,y:d},5>f)break}else f>2e3?m=100:f>100&&(m=Math.floor(f/2));return k},c.handleSelect=function(a,b){var e=c.data,f=e.width/2,g=e.height/2,h=Math.sqrt(Math.pow(a-f,2)+Math.pow(b-g,2));if(h<e.radius){c.lastPosition={x:a,y:b},c.draw(c.lastPosition);var i=e.context.getImageData(a,b,1,1),j=i.data,k=tinycolor.fromRatio({r:j[0],g:j[1],b:j[2]}),l=k.toRgbString();if(c.colorElem.css("background",l),d){var m=k.toHsv();d(c.keepBright?"hsv("+parseInt(m.h)+","+parseInt(100*m.s)+c.bright:"hsv("+parseInt(m.h)+","+parseInt(100*m.s)+","+100*m.v+")")}return!0}return h>1.2*e.radius?(c.hide(),!1):void 0}}return c};return{restrict:"A",template:"<div></div>",scope:{color:"=ikColor"},link:function(c,d,e){var g="20px",h="20px",i="rgba(221,221,221,.6)",j=!1;c.name="Color";var k=d.children();e.ikColorHeight&&(g=e.ikColorHeight),e.ikColorWidth&&(h=e.ikColorWidth),e.ikColorBorder&&(i=e.ikColorBorder),e.ikColorName&&(c.name=e.ikColorName),e.ikColorKeepBright&&(j=!0);var l=b(e.ikColorPickerChange);k.css({background:tinycolor(c.color).toRgbString(),height:g,width:h," border":"solid 1px "+i,"border-radius":"16px"});var m=null,n=function(b){m&&a.cancel(m),m=a(function(){c.color=b,l&&l(c.$parent,{color:b})},50)};if(angular.isDefined(e.ikColorPickerShow)){var o=c.$parent.$watch(e.ikColorPickerShow,function(a,b){a?f().show(c.color,c.name,j,n):angular.isDefined(b)&&f().hide()});d.on("$destroy",o)}else d.on("click",function(){f().show(c.color,c.name,j,n)});if(angular.isDefined(c.color)){var p=c.$watch("color",function(){if(j){var a=c.color.match(/^(.*)(,[0-9%]*\))/),b=tinycolor("hsv"+a[1]+",100)");k.css("background",b.toRgbString())}else k.css("background",tinycolor(c.color).toRgbString())});d.on("$destroy",p)}}}}]),function(){var a=angular.module("ik.directives"),b="ikEnter";a.directive(b,["$document","$timeout",function(a,b){return{link:function(a,b,c){var d=function(b){b.keyCode==VK_ENTER&&(a.$eval(c.ikEnter),b.preventDefault(),b.stopPropagation())};b.on("keydown",d),b.on("$destroy",function(){b.off("keydown",d)})}}}])}(),function(){var a=["up","down","left","right"],b=angular.module("ik.lib.directives");angular.forEach(a,function(a){var c="ikNav"+a.charAt(0).toUpperCase()+a.slice(1);b.directive(c,["$document","$timeout",function(b,d){return{link:function(b,d,e){var f=function(b){var d=e[c],f=!1;if("up"==a?(38==b.keyCode||b.keyCode==VK_UP)&&(f=!0):"down"==a?(40==b.keyCode||b.keyCode==VK_DOWN)&&(f=!0):"left"==a?(37==b.keyCode||b.keyCode==VK_LEFT)&&(f=!0):"right"==a&&(39==b.keyCode||b.keyCode==VK_RIGHT)&&(f=!0),f){var g=document.querySelector(d);g.focus(),b.preventDefault(),b.stopPropagation()}};d.on("keydown",f),d.on("$destroy",function(){d.off("keydown",f)})}}}])})}(),angular.module("simpleApp",["ngCookies","hagw.model","ik.lib.directives","ik.directives","hagw.utils","ikatu.filters","hmTouchEvents"]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self","**"])}]),angular.module("simpleApp").directive("widgetMacro",["Command","Utilities","$timeout","$rootScope",function(a,b,c,d){return{restrict:"C",templateUrl:"views/widgets/macro.html",link:function(a,b,c){var d=function(b){b.keyCode==VK_ENTER&&a.$apply(a.FIRE())};b.parent().on("keypress",d),b.on("$destroy",function(){b.parent().off("keypress",d)})},controller:["$scope","$element","$window","$rootScope",function(b,c,d,e){a.addMand(b,"FIRE"),b.active=!1,a.verify(b,c)}]}}]),angular.module("simpleApp").directive("widgetThermostat1sp",["Command","Utilities","$rootScope","$timeout",function(a,b,c,d){var e,f=15e3,g=1e3;e=isTvApp?"views/widgets/thermostatTv.html":"views/widgets/thermostatWeb.html";var h=function(b,c,e){var h=b,i=c,j=null,k=null,l=[];angular.isDefined(h.setValue)||(h.setValue={}),h.setValue[c]=null,h.$watch("resource.state['"+i+"']",function(a,b){if(l.length){var e=l.indexOf(a);e>=0&&(e==l.length-1?(l=[],k&&!j&&(d.cancel(k),k=null,h.setValue[c]=null)):l=l.slice(e))}});var m=function(a,b){var c=b,d=(a.resource.system&&a.resource.system.spec?a.resource.system.spec.stringId:"",a.resource.state&&a.resource.state["_SETPOINT LIMITS"]?a.resource.state["_SETPOINT LIMITS"]:null),e=null,f=null;if(d){var g=d.match(/([0-9]*)-([0-9]*)F/),h=d.match(/([0-9]*)-([0-9]*)C/);"F"==a.units.temperature?(e=parseInt(g[1]),f=parseInt(g[2])):(e=parseInt(h[1]),f=parseInt(h[2]))}return c=null!=e&&e>b?e:null!=f&&b>f?f:b};a.addMand(h,"SET "+i,{argFun:function(a){return console.log("Change "+c+": SET TO: "+a),{VALUE:a}}}),h["CHANGE_"+e]=function(a){var b=h.setValue[c];null===b&&(b=h.resource.state[c]);var i=m(h,b+a);if(i!=b){var n=i;h.setValue[c]=n,j&&d.cancel(j),k&&d.cancel(k);var o=h.resource.spec&&h.resource.spec.SETPOINTS_MINIMUM_DISTANCE?h.resource.spec.SETPOINTS_MINIMUM_DISTANCE:1;if(o>-1){var p=parseInt(o);if("HEAT_SP"==e){var q=h.setValue&&h.setValue["COOL SP"]?h.setValue["COOL SP"]:h.resource.state["COOL SP"];n+p>q&&h.CHANGE_COOL_SP(n+p-q)}else if("COOL_SP"==e){var r=h.setValue&&h.setValue["HEAT SP"]?h.setValue["HEAT SP"]:h.resource.state["HEAT SP"];r>n-p&&h.CHANGE_HEAT_SP(n-p-r)}}k=d(function(){console.log("Change "+c+": Timedout while waiting for status update to match our set commands"),k=null,h.setValue[c]=null},f),j=d(function(){h["SET_"+e](n),l.push(n),j=null},g)}}};return{restrict:"C",templateUrl:e,link:function(b,d,e){if(b.mode="setheat",b.units=c.units,angular.isDefined(b.opts.THERMOSTAT_2SP)?(b.heatSetpoint=h(b,"HEAT SP","HEAT_SP"),b.coolSetpoint=h(b,"COOL SP","COOL_SP")):b.setSetpoint=h(b,"SETPOINT","SETPOINT"),b.toggleOnOff=function(){"Off"!=b.resource.state.MODE&&"0"!=b.resource.state.MODE?b.SET_MODE("Off"):b.SET_MODE("Auto")},b.resource.spec.commandSpecs){var f=null;angular.forEach(b.resource.spec.commandSpecs,function(a){"SET MODE"==a.name&&(f=a)}),f&&(a.addOpt(b,"SET MODE",{argFun:function(a){return{VALUE:a}}}),b.IS_VALID_MODES={},b.NOF_MODES=0,angular.forEach(f.arguments.VALUE.values,function(a){("Heat"==a||"Cool"==a||"Off"==a||"Auto"==a||"Eco"==a)&&(b.IS_VALID_MODES[a]=!0,b.NOF_MODES++)}))}a.addOpt(b,"SET FAN AUTO",{argFun:function(a){return{VALUE:a?1:0}}}),a.addOpt(b,"SET SCHEDULE",{argFun:function(a){return{VALUE:a?1:0}}}),a.addOpt(b,"SET ECOMODE",{argFun:function(a){return{VALUE:a?1:0}}}),a.verify(b,d);var g=function(a){if(b.NOF_MODES>1){b.nextModeTv=a;do switch(b.nextModeTv){case"Off":b.nextModeTv="Auto";break;case"Auto":b.nextModeTv="Eco";break;case"Eco":b.nextModeTv="Heat";break;case"Heat":b.nextModeTv="Cool";break;case"Cool":default:b.nextModeTv="Off"}while(!b.IS_VALID_MODES[b.nextModeTv]);return b.nextModeTv}},i=(b.$watch("mode",g),function(a){switch(a.keyCode){case VK_GREEN:a.preventDefault(),a.stopPropagation()}}),j=function(a){switch(console.log("keypress on widgetThermostat1sp "+a.keyCode),a.keyCode){case VK_GREEN:case BK_GREEN:b.mode="setheat"==b.mode?"setcool":"setheat",c.$emit("focusedWidget",b),c.$apply(),a.preventDefault(),a.stopPropagation();break;case VK_ENTER:a.preventDefault(),b.SET_MODE(b.nextModeTv),g(b.nextModeTv);break;case VK_REWIND:case BK_REWIND:case VK_STEP_DW:b.hasSET_SETPOINT?b.CHANGE_SETPOINT(-1):"setheat"===b.mode?b.CHANGE_HEAT_SP(-1):"setcool"===b.mode&&b.CHANGE_COOL_SP(-1),a.preventDefault();break;case VK_FAST_FWD:case BK_FAST_FWD:case VK_STEP_UP:b.hasSET_SETPOINT?b.CHANGE_SETPOINT(1):"setheat"==b.mode?b.CHANGE_HEAT_SP(1):"setcool"==b.mode&&b.CHANGE_COOL_SP(1),a.preventDefault()}};d.on("focus",function(a){c.$emit("focusedWidget",b),c.$apply()}),d.on("blur",function(a){c.$emit("focusedWidget",void 0),c.$apply()}),d.on("$destroy",function(){c.$emit("focusedWidget",void 0)}),d.parent().on("keydown",j),d.parent().on("keyup",i),d.on("$destroy",function(){d.parent().off("keydown",j),d.parent().off("keyup",i)})}}}]),angular.module("simpleApp").directive("widgetDimmer",["$rootScope","Command","Utilities","smartIncreaser",function(a,b,c,d){var e;return e=isTvApp?"views/widgets/dimmerTv.html":"views/widgets/dimmerWeb.html",{restrict:"C",templateUrl:e,link:function(c,e,f){var g=d.create();c.mode="normal",b.addMand(c,"SET COLOR",{argFun:function(a){return console.log(a),{COLOR:a}}}),b.addMand(c,"SET",{argFun:function(a){var b=0;return b="number"==typeof a?a>100?100:0>a?0:a:parseInt(event.offsetX/event.target.clientWidth*100),angular.isDefined(c.resource.state)&&angular.isDefined(c.resource.state.LEVEL)&&g.setValue(c.resource.state.LEVEL,b),{LEVEL:b}}}),b.verify(c,e),c.TOGGLE=function(){if(angular.isDefined(c.resource.state.LEVEL)){var a=g.toggleValue(c.resource.state.LEVEL);c.SET(a)}},c.CHANGE=function(a){if(angular.isDefined(c.resource.state.LEVEL)){var b=g.increaseValue(c.resource.state.LEVEL,a);c.SET(b)}},c.UPDATECOLOR=function(a){a&&c.SET_COLOR(a)};var h=function(b){switch(console.log("key on widgetDimmer "+b.keyCode),console.log(b.keyCode),b.keyCode){case VK_STEP_DW:case BK_STEP_DW:case VK_REWIND:case BK_REWIND:angular.isDefined(c.resource.state.LEVEL)&&(c.CHANGE(-10),c.$apply(),b.preventDefault());break;case VK_STEP_UP:case BK_STEP_UP:case VK_FAST_FWD:case BK_FAST_FWD:angular.isDefined(c.resource.state.LEVEL)&&(c.CHANGE(10),c.$apply(),b.preventDefault());break;case VK_0:c.$apply(c.SET(0)),b.preventDefault();break;case VK_1:c.$apply(c.SET(10)),b.preventDefault();break;case VK_2:c.$apply(c.SET(20)),b.preventDefault();break;case VK_3:c.$apply(c.SET(30)),b.preventDefault();break;case VK_4:c.$apply(c.SET(40)),b.preventDefault();break;case VK_5:c.$apply(c.SET(52)),b.preventDefault();break;case VK_6:c.$apply(c.SET(64)),b.preventDefault();break;case VK_7:c.$apply(c.SET(76)),b.preventDefault();break;case VK_8:c.$apply(c.SET(88)),b.preventDefault();break;case VK_9:c.$apply(c.SET(100)),b.preventDefault();break;case VK_ENTER:if("normal"===c.mode){angular.isDefined(c.resource.state.LEVEL)&&c.$apply(c.TOGGLE()),b.preventDefault();break}case VK_BLUE:case BK_BLUE:c.hasSET_COLOR&&(c.mode="color"===c.mode?"normal":"color",c.$apply(),a.$emit("focusedWidget",c),a.$apply(),b.preventDefault(),b.stopPropagation())}};e.parent().on("keydown",h),e.on("$destroy",function(){e.parent().off("keydown",h)})}}}]),angular.module("simpleApp").directive("widgetButton",["Command","Utilities","$timeout","$rootScope",function(a,b,c,d){return{restrict:"C",templateUrl:"views/widgets/button.html",link:function(a,b,d){a.pressed=!1;var e=function(b){b.keyCode==VK_ENTER&&(a.hasRELEASE&&a.RELEASE(),a.pressed=!1,c(function(){a.active=!1},200),b.preventDefault())},f=function(b){b.keyCode!=VK_ENTER||a.pressed||(a.PRESS(),a.pressed=!0,a.active=!0,a.hasHOLD&&c(function(){a.pressed&&a.HOLD()},200))};b.parent().on("keydown",f),b.parent().on("keyup",e),b.on("$destroy",function(){b.parent().off("keydown",f),b.parent().off("keyup",e)})},controller:["$scope","$element","$timeout","$window","$rootScope",function(b,c,d,e,f){a.addMand(b,"PRESS"),a.addOpt(b,"HOLD"),a.addOpt(b,"RELEASE"),b.active=!1,a.verify(b,c)}]}}]),angular.module("simpleApp").directive("widgetShade",["Command","Utilities",function(a,b){var c;return c=isTvApp?"views/widgets/shadeTv.html":"views/widgets/shadeWeb.html",{restrict:"C",templateUrl:c,link:function(b,c,d){a.addMand(b,"RAISE"),a.addMand(b,"LOWER"),a.addMand(b,"STOP"),a.addOpt(b,"SET",{argFun:function(a){return"number"==typeof a?{LEVEL:a>100?100:0>a?0:a}:{LEVEL:parseInt(event.offsetX/event.target.clientWidth*100)}}}),a.addOpt(b,"PRESET",{argFun:function(a){return{NUM:parseInt(a)}}}),a.verify(b,c);var e=function(a){switch(console.log("keypress on widgetShade"+a.keyCode),a.keyCode){case VK_ENTER:b.$apply(b.STOP()),a.preventDefault();break;case VK_STEP_DW:case BK_STEP_DW:case VK_REWIND:case BK_REWIND:b.$apply(b.LOWER()),a.preventDefault();break;case VK_STEP_UP:case BK_STEP_UP:case VK_FAST_FWD:case BK_FAST_FWD:b.$apply(b.RAISE()),a.preventDefault();break;case VK_0:b.hasSET&&(b.$apply(b.SET(0)),a.preventDefault());break;case VK_1:b.hasSET&&(b.$apply(b.SET(10)),a.preventDefault());break;case VK_2:b.hasSET&&(b.$apply(b.SET(20)),a.preventDefault());break;case VK_3:b.hasSET&&(b.$apply(b.SET(30)),a.preventDefault());break;case VK_4:b.hasSET&&(b.$apply(b.SET(40)),a.preventDefault());break;case VK_5:b.hasSET&&(b.$apply(b.SET(52)),a.preventDefault());break;case VK_6:b.hasSET&&(b.$apply(b.SET(64)),a.preventDefault());break;case VK_7:b.hasSET&&(b.$apply(b.SET(76)),a.preventDefault());break;case VK_8:b.hasSET&&(b.$apply(b.SET(88)),a.preventDefault());break;case VK_9:b.hasSET&&(b.$apply(b.SET(100)),a.preventDefault())}};c.on("$destroy",function(){c.parent().off("keydown",e)}),c.parent().on("keydown",e)}}}]),angular.module("simpleApp").directive("widgetCameras",["$rootScope","Utilities",function(a,b){var c=isTvApp?"views/partials/camerasTv.html":"views/partials/camerasWeb.html";return{restrict:"A",templateUrl:c,scope:{resource:"=widgetCameras"},compile:function(b,c,d){return function(b,c,d){b.currentCamera=void 0,b.focused=!1;var e=function(){var c=b.currentCamera;b.resource&&(angular.isDefined(b.resource.cameras)&&angular.isDefined(b.resource.cameras.length>0)?(b.currentCamera&&b.currentCamera.id&&(b.currentCamera=_.find(b.resource.cameras,{id:b.currentCamera.id})),a.lastCameraId&&(b.currentCamera=_.find(b.resource.cameras,{id:a.lastCameraId})),angular.isUndefined(b.currentCamera)&&(b.currentCamera=b.resource.cameras[0])):b.currentCamera=void 0,c!=b.currentCamera&&f())},f=function(){b.focused&&a.$emit("focusedWidget",{resource:b.currentCamera})};b.moreOneCamera=function(){return b.resource.cameras.length>1},b.changeCamera=function(c){if(b.resource){var d=b.resource.cameras,e=-1;c<d.length&&(angular.isDefined(b.currentCamera)&&(e=_.findIndex(d,{id:b.currentCamera.id})),-1==e?e=0:(e+=c,0>e?e=d.length+e:e>=d.length&&(e-=d.length)),b.currentCamera=d[e],a.lastCameraId=b.currentCamera.id,f())}};var g=function(a){return function(){b.changeCamera(a)}};unregNext=a.$on("widgetCameras:next",g(1)),unregPrev=a.$on("widgetCameras:prev",g(-1)),c.on("focusin",function(){b.focused=!0,b.$apply()}),c.on("focusout",function(){b.focused=!1,b.$apply()}),b.$on("$destroy",function(){unregNext(),unregPrev()}),b.$watch("resource.id",e)}}}}]),angular.module("simpleApp").directive("widgetCamerasimple",["Command","Utilities",function(a,b){return{restrict:"C",templateUrl:"views/partials/camera.html",link:function(a,b,c){},controller:["$scope","$element",function(b,c){a.verify(b,c)}]}}]),angular.module("simpleApp").directive("widgetCamerasimpleweb",["Command","Utilities",function(a,b){return{restrict:"C",templateUrl:"views/partials/cameraWeb.html",link:function(a,b,c){},controller:["$scope","$element",function(c,d){var e=function(){c.concat=b.concatUrl(c.currentCamera.user,c.currentCamera.password,c.currentCamera.baseUrl,c.currentCamera.lowResolutionPath)};a.verify(c,d);var f=c.$watch("currentCamera",e),g=c.$watch("resource",e);c.$on("$destroy",function(){f(),g()})}]}}]),angular.module("simpleApp").directive("widgetCameraptzweb",["Command","Utilities","auth",function(a,b,c){return{restrict:"C",templateUrl:"views/partials/camera_ptzWeb.html",$scope:{resource:"="},controller:["$scope","$element",function(b,c){var d=function(){var d="/a/exe/"+b.currentCamera.zone.area.name+"/"+b.currentCamera.zone.name+"/CAMERA/"+b.currentCamera.name;"/a/webview/"+b.currentCamera.zone.area.name+"/"+b.currentCamera.zone.name+"/CAMERA/"+b.currentCamera.name,a.addMand(b,"panright",{url:d+"/PAN RIGHT",camera:!0}),a.addMand(b,"panleft",{url:d+"/PAN LEFT",camera:!0}),a.addMand(b,"panstop",{url:d+"/PAN STOP",camera:!0}),a.addMand(b,"tiltup",{url:d+"/TILT UP",camera:!0}),a.addMand(b,"tiltdown",{url:d+"/TILT DOWN",camera:!0}),a.addMand(b,"tiltstop",{url:d+"/TILT STOP",camera:!0}),a.addMand(b,"home",{url:b.currentCamera.homePath,camera:!0}),a.addOpt(b,"zoomin",{url:b.currentCamera.zoomInPath,camera:!0}),a.addOpt(b,"zoomout",{url:b.currentCamera.zoomOutPath,camera:!0}),a.addOpt(b,"zoomstop",{url:b.currentCamera.zoomStopPath,camera:!0}),a.verify(b,c)},e=b.$watch("currentCamera",d),f=b.$watch("resource",d);b.$on("$destroy",function(){e(),f()})}]}}]),angular.module("simpleApp").directive("widgetCameraptz",["Command","Utilities",function(a,b){return{restrict:"C",templateUrl:"views/partials/camera_ptzTv.html",link:function(a,b,c){},controller:["$scope","$element",function(b,c){var d=function(){b.currentCamera=b.resource;var d="/a/exe/"+b.currentCamera.zone.area.name+"/"+b.currentCamera.zone.name+"/CAMERA/"+b.currentCamera.name;a.addMand(b,"panright",{url:d+"/PAN RIGHT",camera:!0}),a.addMand(b,"panleft",{url:d+"/PAN LEFT",camera:!0}),a.addMand(b,"panstop",{url:d+"/PAN STOP",camera:!0}),a.addMand(b,"tiltup",{url:d+"/TILT UP",camera:!0}),a.addMand(b,"tiltdown",{url:d+"/TILT DOWN",camera:!0}),a.addMand(b,"tiltstop",{url:d+"/TILT STOP",camera:!0}),a.addMand(b,"zoomin",{url:d+"/ZOOM IN",camera:!0}),a.addMand(b,"zoomout",{url:d+"/ZOOM OUT",camera:!0}),a.addMand(b,"zoomstop",{url:d+"/ZOOM STOP",camera:!0}),a.verify(b,c)},e=function(a){switch(console.log("keypress on widgetCameraptz"+a.keyCode),a.keyCode){case VK_STEP_DW:case BK_STEP_DW:b.tiltdown(),a.preventDefault();break;case VK_STEP_UP:case BK_STEP_UP:b.tiltup(),a.preventDefault();break;case VK_REWIND:case BK_REWIND:b.panleft(),a.preventDefault();break;case VK_FAST_FWD:case BK_FAST_FWD:b.panright(),a.preventDefault()}};c.parent().on("keypress",e),b.$on("$destroy",function(){c.parent().off("keypress",e)});var f=b.$watch("currentCamera",d),g=b.$watch("resource",d);b.$on("$destroy",function(){f(),g()})}]}}]),angular.module("simpleApp").directive("widgetGpio",["Command","Utilities",function(a,b){return{restrict:"C",templateUrl:"views/widgets/gpio.html",link:function(a,b,c){},controller:["$scope","$element",function(b,c){a.addOpt(b,"SET",{argFun:function(a){return{LEVEL:a?1:0}}}),a.addOpt(b,"TOGGLE"),a.verify(b,c)}]}}]),angular.module("simpleApp").directive("widget",["$compile","$rootScope",function(a,b){return{restrict:"C",priority:100,scope:{resource:"=",index:"=",last:"="},link:function(c,d,e){c.opts={};var f=function(){if(angular.isDefined(c.resource)){if(angular.isDefined(c.resource.spec)){var b=c.resource.spec.type.toLowerCase().replace(" ","").replace("_","");"THERMOSTAT_2SP"==c.resource.spec.type&&(c.opts.THERMOSTAT_2SP=!0,b="thermostat1sp")}else"cameras"===c.resource.type&&(b="cameras");b='class="widget-'+b+'" widget-'+b+'="resource"',d.html("<div "+b+"></div>"),a(d.contents())(c)}},g=c.$watch("resource",f);d.on("focus",function(a){b.$emit("focusedWidget",c),b.$apply()}),d.on("blur",function(a){b.$emit("focusedWidget",void 0),b.$apply()}),d.on("$destroy",function(){g(),b.$emit("focusedWidget",void 0)})}}}]),angular.module("simpleApp").directive("meter",function(){var a,b=/.*.xhtml$/;return a=b.test(location.href)?'<div class="meter-common meter-level"></div><div class="meter-common meter-fg"   ></div>':'<div class="meter-common meter-level"></div><div class="meter-common meter-fg"   ></div><div class="meter-set" ng-click="SET($event)"></div>',{template:a,restrict:"C",link:function(a,b,c){var d=function(){angular.element(b.children()[1]).css("width",100-a.resource.state.LEVEL+"%")};a.$watch("resource.state.LEVEL",d)}}}).directive("zoneState",["State",function(a){return{restrict:"C",templateUrl:"views/partials/zoneState.html",scope:{list:"="},controller:["$scope","State",function(a,b){a.compute=function(){a.state={};for(var c=0;c<a.list.length;c++)"resources"==a.list[c].backend&&(a.state[a.list[c].spec.type]=angular.isDefined(a.state[a.list[c].spec.type])&&a.state[a.list[c].spec.type]||b.activeResource(a.list[c]));return a.state.THERMOSTAT=a.state.THERMOSTAT_1SP||a.state.THERMOSTAT_2SP,a.state!={}}}]}}]),angular.module("simpleApp").directive("realtimeImage",["$timeout","$http","$rootScope",function(a,b,c){return{scope:{realtimeImage:"="},compile:function(b,d,e){var f=0,g=50,h=0,i="",j="",k=!1,l=(new Date).getTime();return function(b,d,e){var m=[],n=[],o=null,p=angular.element("<div style='position:absolute; top:50%; height: 4em;margin-top:-2em; padding-top: 1.5em; left:0; right:0; text-align:center; background: rgba(0,0,0,.5); color: white; opacity:0; transition: opacity 1s'></div>");m.push(angular.element(new Image)),m.push(angular.element(new Image)),d.html(""),d.append(m[0]),d.append(m[1]),d.append(p),d.css({background:"rgba(255,255,255,.1)"}),m[0][0].alt="",m[1][0].alt="",m[0][0].height=100,m[0].css("height","100%"),m[1].css("height","100%");var q=function(){f=0,g=50,h=0,k=!1,j="/a/webview/"+b.realtimeImage.zone.area.name+"/"+b.realtimeImage.zone.name+"/CAMERA/"+b.realtimeImage.name+"/snapshot?hr=false",j+=j.indexOf("?")<0?"?":"&",p.html("Loading: "+b.realtimeImage.name),p.css("opacity",1),n[f%2]?(m[f%2].css("opacity",.5),m[(f+1)%2].css("opacity",0)):n[(f+1)%2]?(m[f%2].css("opacity",0),m[(f+1)%2].css("opacity",.5)):(m[0].css("opacity",0),m[1].css("opacity",0)),f++;try{m[f%2][0].src=j+"+blgwCount="+l+"-"+f}catch(a){navigator.userAgent.indexOf("MSIE")>=0?p.html('"'+b.realtimeImage.name+'" is incompatible with IE (KB885136).'):p.html('"'+b.realtimeImage.name+'" is incompatible with your browser.')}n[f%2]=!1},r=function(a){n[f%2]?(m[f%2].css("opacity",.5),m[(f+1)%2].css("opacity",0)):n[(f+1)%2]?(m[f%2].css("opacity",0),m[(f+1)%2].css("opacity",.5)):(m[0].css("opacity",0),m[0].css("opacity",0)),k=!0,p.html('Error loading camera "'+b.realtimeImage.name+'"'),p.css("opacity",1),console.error('Camera "'+b.realtimeImage.name+'" fail to load using URL "'+i+'"')},s=function(a){a==f%2&&(n[a]=!0,p.css("opacity")>0&&p.css("opacity",0))};m[0].on("load",function(a){s(0)}),m[1].on("load",function(a){s(1)}),m[0].on("error",function(a){r(0)}),m[1].on("error",function(a){r(1)});var t=function(){isTvApp&&!c.appFocussed?o=a(t,100):(h+=g,n[f%2]?g=.9*h:h>g&&(g=.1*h),g=Math.min(5e3,g),g=Math.max(150,g),(n[f%2]||k)&&(n[f%2]&&(f%2==1?(m[1].css("opacity",1),m[0].css("opacity",.5),m[0][0].removeAttribute("src")):(m[0].css("opacity",1),m[1].css("opacity",0),m[1][0].removeAttribute("src"))),k||(h=0),k=!1,f++,m[f%2][0].src=j+"Count="+l+"-"+f,n[f%2]=!1),o=a(t,g))};o=a(t,200),b.$on("$destroy",function(){a.cancel(o)}),b.$watch("realtimeImage.name",q),b.$watch("realtimeImage.zone.name",q),b.$watch("realtimeImage.zone.area.name",q)}},restrict:"A"}}]),angular.module("simpleApp").controller("MainCtrl",["$scope","$location","$log","$rootScope","comm","model","Utilities","State","$window","$timeout","$filter","computeZone",function(b,c,d,e,f,g,h,i,j,k,l,m){g.subscribe(b,"states"),g.subscribe(b,"commandSpecs"),g.subscribe(b,"eventSpecs"),g.subscribe(b,"resourceSpecs",{commandSpecs:"commandSpecs",eventSpecs:"eventSpecs"}),g.subscribe(b,"addressables",{zone:"zones",state:"states",spec:"resourceSpecs"}),g.subscribe(b,"systems",{state:"states"},{reverseLink:{state:"systems"}}),g.subscribe(b,"blChannels"),g.subscribe(b,"blChannelLists",{channels:"blChannels"}),g.subscribe(b,"blSources",{resource:"addressables",channels:"blChannelLists"},{reverseLink:{resource:"sources"}}),g.subscribe(b,"zones",{addressables:"addressables"}),g.subscribe(b,"areas",{zones:"zones"},{reverseLink:{zones:"area"}}),g.subscribe(b,"cameras",{zone:"zones"},{reverseLink:{zone:"cameras"}}),g.subscribe(b,"systemInfo"),g.subscribe(b,"unitSettings"),g.subscribe(b,"experimentalFeatures"),g.load();var n=function(){if(angular.isDefined(c.search().hagwDebug)){var a=c.search().hagwDebug,b=e._debug;e._debug=["1","true","on","yes"].indexOf(a.toLowerCase())>=0,b!==e._debug&&angular.isDefined(s)&&s()}};if(e.$on("$locationChangeStart",n),n(),b.authService=g.authService,b.configLoaded=!1,b.currentZone=void 0,b.currentPanelFocus="zones",b.setPanelFocus=function(a){b.currentPanelFocus=a},isTvApp){var o=parseInt(localStorage.getItem("defaultZoneId"))||0;o&&(b.currentZone={id:o});var p=null;e.appFocussed=!1;var q=function(a){e.appFocussed!=a&&(1==a?(e.$apply("appFocussed = true"),p&&k.cancel(p)):(e.$apply("appFocussed = false"),p=k(function(){var a=parseInt(localStorage.getItem("defaultZoneId"))||0;if(a){var c=_.find(b.zonesWithRes,{id:a});b.setZone(c)}},1e3)))},r=void 0;"undefined"!=typeof document.hidden?r="hidden":"undefined"!=typeof document.msHidden?r="msHidden":"undefined"!=typeof document.webkitHidden&&(r="webkitHidden"),"undefined"!=typeof r&&(e.appFocussed=!document[r],console.log("appFocussed:"+e.appFocussed),angular.element(document).on(r,function(b){a,q(document[r]?!1:!0)})),angular.element(j).on("blur",function(a){(a.target===document||a.target===window)&&q(!1)}),angular.element(j).on("focus",function(a){(a.target===document||a.target===window)&&q(!0)})}b.setFocussedZone=function(a){console.log("setFocussedZone: "+a.name),b.focussedZone=a},e.$on("focusedWidget",function(a,c){b.focusedWidget=c});var s=function(){m.invalidateCache(),b.zonesWithRes=[],angular.forEach(b.areas,function(a){angular.forEach(a.zones,function(a){m.updateResources(a,b.zones),(a.hasResources||!isTvApp&&a.hasAVSources&&e.experimentalFeaturesEnabled.WEBPANEL_AV_CONTROL)&&b.zonesWithRes.push(a)})}),b.zonesWithRes=l("orderInArea")(b.zonesWithRes);var a=void 0;if(b.currentZone&&(a=_.find(b.zonesWithRes,{id:b.currentZone.id}),a&&!a.hasResources&&(a=void 0)),!a)for(var c=0;c<b.zonesWithRes.length;c++)if(b.zonesWithRes[c].hasResources&&b.zonesWithRes[c].addressables.length>0){a=b.zonesWithRes[c];break}b.setZone(a)};e.experimentalFeaturesEnabled={};var t=function(){angular.forEach(b.experimentalFeatures,function(a){
e.experimentalFeaturesEnabled[a.name]=a.enabled})},u=null;b.$on("model:updated",function(a,c){if(c&&c.backend&&"experimentalFeatures"!=c.backend||t(),(!c||c.backend&&"states"!=c.backend)&&(b.configLoaded=!0,c?(u&&k.cancel(u),u=k(s,100)):s()),(!c||!c.backend)&&b.states||c.backend&&"states"==c.backend)if(c&&c.backend&&"states"==c.backend){var d=_.find(b[c.backend],{id:c.id});d.systems&&1==d.systems.length&&(e.systemStateById[d.systems[0].id]="Online"==d.CONNECTION)}else c&&c.backend||(e.systemStateById={},angular.forEach(b.systems,function(a){var b=!a.state||"Online"==a.state.CONNECTION;e.systemStateById[a.id]=b}));if((!c||c.backend&&"systemInfo"==c.backend)&&b.systemInfo&&b.systemInfo[0]){var f=b.systemInfo[0],h=f.versionHigh+"."+f.versionLow+"."+f.versionSub+"."+f.versionSigned;e.fwver?e.fwver!=h&&location.reload(!0):e.fwver=h}(!c||c.backend&&"unitSettings"==c.backend)&&(e.units=b.unitSettings[0],e.prevUnit&&e.prevUnit.temperature&&e.units.temperature!=e.prevUnit.temperature&&g.load(!0),e.prevUnit=_.clone(e.units))}),b.setZone=function(a){a&&a.id?(b.currentZone=a,b.currentResource=null,k(function(){a.showableResources&&a.showableResources.length>0&&a.showableResources[0].zone.id==b.currentZone.id?(b.currentResource=a.showableResources[0].id,b.currentPanelFocus="widgets"):k(function(){a.showableResources&&a.showableResources.length>0&&(b.currentResource=a.showableResources[0].id,b.currentPanelFocus="widgets")},2e3,!0)},100,!0),b.selectedResources=a.resources,!isTvApp&&angular.isDefined(a)&&(a.showableGroups=m.updateGroups(a.showableResources,a.camerasWidget,a.AVSources))):b.currentZone=void 0},b.setZoneIfFocused=function(a){var c=j.innerWidth;"zones"===b.currentPanelFocus||c>=ipadWidthLandscape?b.setZone(a):b.currentPanelFocus="zones"};var v=function(){var a=b.currentZone;!isTvApp&&angular.isDefined(a)&&(a.showableGroups=m.updateGroups(a.showableResources,a.camerasWidget,a.AVSources)),b.$apply()},w=0,x=[VK_GREEN,VK_BLUE,VK_GREEN],y=function(a){if(console.log("key event on main.js: "+a.type+" -> "+a.keyCode),isTvApp)switch(a.keyCode==x[w]?(w++,w>=x.length&&(location.href="/ixp/index.xhtml",a.preventDefault())):w=0,a.keyCode){case VK_BACK:case BK_BACK:a.preventDefault(),a.stopPropagation();break;case VK_STOP:case BK_STOP:e.$broadcast("loginCtrl:logout");break;case VK_RED:case BK_RED:for(var c=0,d=!1;c<b.zonesWithRes.length&&!d;)b.zonesWithRes[c].id==b.currentZone.id&&(c>=0&&(c==b.zonesWithRes.length-1?b.setZone(b.zonesWithRes[0]):b.setZone(b.zonesWithRes[c+1]),b.$apply()),d=!0),c++;break;case VK_GREEN:case BK_GREEN:b.focusedWidget||(localStorage.setItem("defaultZoneId",b.focussedZone.id),alertify.success("Default zone changed: '"+b.focussedZone.name+"'"));break;case VK_YELLOW:case BK_YELLOW:e.$emit("widgetCameras:next"),e.$apply();break;case VK_BLUE:case BK_BLUE:b.displayAll?b.$apply("displayAll = false"):b.$apply("displayAll = true"),a.preventDefault()}};e.isResourceOnline=function(a){var b=!0,b=!a.links||!a.links.system||e.systemStateById[a.links.system];return b&=!a.state||!angular.isDefined(a.state.ONLINE)||a.state.ONLINE},isTvApp||angular.element(j).on("resize",v),angular.element(j).on("keyup",y),b.$on("$destroy",function(){isTvApp||angular.element(j).off("resize",v),angular.element(j).off("keyup",y)})}]).controller("stateCtrl",["$rootScope","$scope","model",function(a,b,c){c.subscribe(b,"projectInfo"),c.subscribe(b,"systems",{state:"states"}),c.subscribe(b,"states"),c.subscribe(b,"systemInfo"),a.getModelState=c.getState,a.getModelStateDescription=c.getStateDescription,a.getModelStateIsProcessing=c.isProcessing,a.getModelStateIsConnected=c.isConnected}]),angular.module("simpleApp").controller("loginCtrl",["$scope","$timeout","model",function(a,b,c){a.settings={},a.settings.user="",a.settings.password="",a.settings.storePassword=!1,a.authService=c.authService,a.msg="",a.userRetry=0,a.hasLocalStorage=testLocalStorage(),a.hasLocalStorage&&(a.settings.user=localStorage.getItem("user")||"",a.settings.storePassword=localStorage.getItem("storePassword"),isTvApp&&null===a.settings.storePassword&&(a.settings.storePassword=!0),a.settings.storePassword&&(a.settings.password=localStorage.getItem("password")||"",c.authService.loginConfirmed(null,a.settings.user,a.settings.password))),a.$on("model:loginRequired",function(b,c){a.userRetry>0?a.msg="Invalid user or password, please try again.":a.msg=""}),a.$on("model:loginOk",function(b,c){a.msg="",a.userRetry=0}),a.login=function(){a.msg="Connecting...",a.userRetry++,b(function(){c.authService.loginConfirmed(null,a.settings.user,a.settings.password)},500),a.hasLocalStorage&&(localStorage.setItem("storePassword",a.settings.storePassword),localStorage.setItem("user",a.settings.user),a.settings.storePassword?localStorage.setItem("password",a.settings.password):localStorage.setItem("password",""))},a.logout=function(){a.settings.storePassword&&localStorage.removeItem("password"),a.userRetry=0,c.authService.logout()},a.$on("loginCtrl:logout",a.logout)}]),angular.module("simpleApp").controller("footerTvCtrl",["$rootScope","$scope",function(a,b){b.focusedWidgetType="",b.widgetMode="",a.$on("focusedWidget",function(a,c){c?(c&&c.mode?b.widgetMode=c.mode:b.widgetMode="",c.resource&&""!=c.resource.tiltUpPath&&""==c.resource.zoomInPath?b.focusedWidgetType="camWithoutZoom":c.resource&&c.haszoomin&&""!=c.resource.zoomInPath?b.focusedWidgetType="camWithZoom":c.resource&&""==c.resource.tiltUpPath&&""==c.resource.zoomInPath?b.focusedWidgetType="camerasimple":angular.isDefined(c.resource)&&c.resource.spec&&"BUTTON"==c.resource.spec.type&&!c.hasHOLD?b.focusedWidgetType="buttonWithoutHold":angular.isDefined(c.resource)&&c.resource.spec&&"MACRO"==c.resource.spec.type?b.focusedWidgetType="buttonWithoutHold":angular.isDefined(c.resource)&&c.resource.spec&&"BUTTON"==c.resource.spec.type?b.focusedWidgetType="buttonWithHold":angular.isDefined(c.resource)&&c.resource.spec&&"SHADE"==c.resource.spec.type&&!c.hasSET?b.focusedWidgetType="shade":angular.isDefined(c.resource)&&c.resource.spec&&"SHADE"==c.resource.spec.type&&c.hasSET?b.focusedWidgetType="shadeSet":!c.hasSET||!c.resource||angular.isDefined(c.resource.state)&&angular.isDefined(c.resource.state.LEVEL)||!c.resource.spec||"DIMMER"!=c.resource.spec.type?c.resource&&angular.isDefined(c.resource.state)&&angular.isDefined(c.resource.state.LEVEL)?b.focusedWidgetType="dimmerState":angular.isDefined(c.resource)&&c.resource.spec&&"THERMOSTAT_1SP"==c.resource.spec.type?b.focusedWidgetType="thermostatSimple":angular.isDefined(c.resource)&&c.resource.spec&&"THERMOSTAT_2SP"==c.resource.spec.type?b.focusedWidgetType="thermostat2Set":b.focusedWidgetType="":b.focusedWidgetType="dimmer",b.focusedWidget=c):(b.focusedWidgetType="",b.focusedWidget=null)})}]),angular.module("simpleApp").service("computeZone",["$rootScope","$window","State",function(a,b,c){function d(a){a.spec={},a.panLeftPath.length>0||a.panRightPath.length>0||a.tiltUpPath.length>0||a.tiltDownPath.length>0?a.spec.type="cameraptz":a.spec.type="camerasimple"}function e(a){return["camerasimple","cameraptz","CAMERA","CAMERAPTV"].indexOf(a.spec.type)>=0}function f(a){return"macros"==a.backend&&a.publish||"resources"==a.backend&&a.publish&&["BUTTON","DIMMER","SHADE","THERMOSTAT_1SP","THERMOSTAT_2SP"].indexOf(a.spec.type)>=0}function g(a){return f(a)&&!e(a)}function h(a){return"macros"==a.backend&&a.publish}function i(a){return"resources"==a.backend&&a.publish&&"AV renderer"==a.spec.type}function j(a){var b=0;return angular.isDefined(a.spec)&&angular.isDefined(a.spec.type)&&(("BUTTON"==a.spec.type||"MACRO"==a.spec.type)&&(b=oneRowResource),("SHADE"==a.spec.type||"DIMMER"==a.spec.type)&&(b=twoRowResource),("THERMOSTAT_2SP"==a.spec.type||"THERMOSTAT_1SP"==a.spec.type)&&(b=fourRowResource)),"camera"==a&&(b=sizeCameraDynamic()),b}function k(){var a=b.innerWidth,c=0;return c=a>bigWidth?3:a>mediumWidth&&bigWidth>=a?2:1}function l(b,d){if(angular.isDefined(d)&&d.length>0){for(var e=0;e<d.length;e++){var j=d[e];f(j)||h(j)?(b.showableResources.push(j),b.hasResources=!0,h(j)&&(j.spec=n),g(j)&&(b.zoneState[j.spec.type]=b.zoneState[j.spec.type]||c.activeResource(j))):(a._debug||a.experimentalFeaturesEnabled.WEBPANEL_AV_CONTROL)&&!isTvApp&&i(j)&&j.sources&&j.sources.length>0&&(b.AVSources.push.apply(b.AVSources,j.sources),b.hasAVSources=!0)}angular.isDefined(b.zoneState.THERMOSTAT_1SP)&&angular.isDefined(b.zoneState.THERMOSTAT_2SP)&&delete b.zoneState.THERMOSTAT_1SP}}function m(a){for(var b=0;!o&&b<a.length;){var c=a[b];c.global&&(o=c),b++}return o}var n={type:"MACRO",commandSpecs:[{help:"",name:"FIRE"}]},o=void 0,p=function(a,c,d){var e=k(),f=void 0,g=[],h=b.innerHeight-titleHeight,i=0,l=0,m=!1;return angular.isDefined(d)&&d.length>0&&e>1&&e--,angular.forEach(a,function(a,b){var d=j(a);i>d||1==e&&angular.isDefined(f)?(e>1&&(i-=d),f.push(a)):(f=[],g.push(f),l++,i=h,e==l&&angular.isDefined(c)&&null!=c&&!m&&(i-=j("camera"),m=!0,f.push(c)),i-=d,f.push(a))}),!m&&angular.isDefined(c)&&null!=c&&(f=[],f.push(c),m=!0,g.push(f)),g},q=function(){o=null},r=function(a,b){if(m(b),a.global)return!1;if(a.showableGroups=[],a.camerasWidget=null,a.zoneState={},a.hasAVSources=!1,a.hasResources=!1,a.showableResources=[],a.AVSources=[],angular.isDefined(a.cameras)&&a.cameras.length>0&&(a.camerasWidget={id:"vCam-"+a.id,type:"cameras",cameras:a.cameras},a.hasResources=!0),l(a,a.addressables),a.hasResources){if(o&&o.addressables&&l(a,o.addressables),o&&o.cameras){var c=[];a.camerasWidget&&a.camerasWidget.cameras&&c.push.apply(c,a.camerasWidget.cameras),c.push.apply(c,o.cameras),a.camerasWidget={id:"vCam-"+a.id,type:"cameras",cameras:c}}a.camerasWidget&&a.camerasWidget.cameras&&angular.forEach(a.camerasWidget.cameras,function(a,b){d(a)})}return a.hasResources};return{invalidateCache:q,updateResources:r,updateGroups:p}}]),angular.module("simpleApp").service("Command",["$http","Utilities",function(a,b){return{exe:function(b,c,d){var e,f=angular.isDefined(d.params)?d.params:{},g={};if(angular.isDefined(d.url)){e=d.url;var h=(new Date).getTime();f._blgwts=h}else e="/a/exe/"+encodeURIComponent(b.zone.area.name)+"/"+encodeURIComponent(b.zone.name)+"/"+encodeURIComponent(b.spec.type)+"/"+encodeURIComponent(b.name)+"/"+encodeURIComponent(c);g.url=e,g.method=angular.isDefined(d.method)?d.method:"GET",g.headers=angular.isDefined(d.headers)?d.headers:{},g.params=f,g.cache=!1,a(g).success(function(a,b){var f="[command:success:"+c+"] - "+e,g=angular.isDefined(d.cb)&&"function"==typeof d.cb;g?d[cb](a):console.log(f)}).error(function(a,b){var c="";angular.isDefined(a)&&(c=a.toString());var e="["+b+"]command failed:["+c+"]";angular.isDefined(d.cbErr)&&"function"==typeof d.cbErr?d.cbErr(a,b):console.error(e)})},addCmd:function(a,c,d){var e=this,f=c.split(" ").join("_");if(angular.isDefined(d)||(d={}),d.camera?a["has"+f]=d.url.length>0:a["has"+f]=angular.isDefined(_.find(a.resource.spec.commandSpecs,{name:c})),a["has"+f]){var g=_.debounce(function(b){angular.isDefined(a.resource.spec)?e.exe(a.resource,c,b):e.exe(a.currentCamera,c,b),console.log("command:sent:["+c+"]")},d.debounceTime||0);a[f]=function(a){var b;if(!angular.isDefined(d.argFun)||"function"!=typeof d.argFun||(b=d.argFun(a),-1!==b)){angular.isDefined(b)||(b=a);var c={params:b,headers:d.headers,method:d.method,url:d.url,cb:d.cb,cbErr:d.cbErr};g(c)}}}else!angular.isDefined(d.mand)||d.mand?angular.isDefined(a.resource.spec)?(b.logMissOpt(a.resource.spec.type,c),a.missMand=!0):(b.logMissOpt(a.currentCamera.spec.type,c),a.missMand=!0):a[c]=function(){angular.isDefined(a.resource.spec)?(b.logMissOpt(a.resource.spec.type,c),a.missOpt=!0):(b.logMissOpt(a.currentCamera.spec.type,c),a.missOpt=!0)}},addMand:function(a,b,c){var d=this;d.addCmd(a,b,c)},addOpt:function(a,b,c){var d=this;angular.isDefined(c)?c.mand=!1:c={mand:!1},d.addCmd(a,b,c)},hideIfMissMand:!1,hideIfMissOpt:!1,verify:function(a,b){var c,d=this;d.hideIfMissMand&&a.missMand?c="mandatory":d.hideIfMissOpt&&a.missOpt&&(c="optional"),angular.isDefined(c)&&(console.warn("Resource missing "+c+" command, removing ["+a.resource.spec.type+":"+a.resource.id+"]"),b.parent().attr("style","display:none"))}}}]),angular.module("simpleApp").service("smartIncreaser",["Utilities",function(a){return{create:function(a){var b={value:0,timestamp:0,state:0},c=1e4|a;return{increaseValue:function(a,d){if(angular.isDefined(a)&&angular.isDefined(d)){var e=a+d,f=(new Date).getTime();b.timestamp&&b.timestamp+c>f&&b.state==a&&(e=b.value+d)}return e},toggleValue:function(a){if(angular.isDefined(a)){var d=a>0?0:100,e=(new Date).getTime();b.timestamp&&b.timestamp+c>e&&b.state==a&&(d=b.value>0?0:100)}return d},setValue:function(a,c){angular.isDefined(a)?angular.isDefined(c)?(b.value=c,b.timestamp=(new Date).getTime(),b.state=a):console.error("setValue requires a defined newValue"):console.error("setValue requires a defined currentValue")}}}}}]),angular.module("simpleApp").service("Utilities",[function(){return{logMissMand:function(a,b,c){var d=!angular.isDefined(c)||c?"command":"feedback";console.error(a+" missing mandatory "+d+":["+b+"]")},logMissOpt:function(a,b,c){var d=!angular.isDefined(c)||c?"command":"feedback";console.info(a+" missing optional "+d+":["+b+"]")},debug:function(){return 9001==window.location.port},concatUrl:function(a,b,c,d){var e=c.substr(c.indexOf("//")+2,c.length),f=c.substr(0,c.indexOf("//")+2);if(a.length>0&&b.length>0)var g=f+a+":"+b+"@"+e+d;else var g=f+e+d;return g}}}]).service("auth",[function(){this.base64_encode=function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)}}]),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){null==b?b=0:0>b&&(b=Math.max(0,this.length+b));for(var c=b,d=this.length;d>c;c++)if(this[c]===a)return c;return-1}),angular.module("simpleApp").service("State",["Utilities",function(a){return{activeGeZero:function(a){return angular.isDefined(a)&&a>0},activeResource:function(a){var b=!1;switch(a.spec.type){case"BUTTON":case"GPIO":angular.isDefined(a.state)&&(b=this.activeGeZero(a.state.STATE));break;case"DIMMER":case"SHADE":angular.isDefined(a.state)&&(b=this.activeGeZero(a.state.LEVEL));break;case"THERMOSTAT_1SP":case"THERMOSTAT_2SP":b=angular.isDefined(a.state)&&"Off"!=a.state}return b}}}]);var bigWidth=1280,ipadWidthLandscape=1024,ipadWidthPortrait=720,mediumWidth=640,iphonePortrail=320,smallWidth=140,titleHeight=52,marginHeight=10,rowHeight=52,oneRowResource=rowHeight+marginHeight,twoRowResource=2*rowHeight+2*marginHeight,fourRowResource=4*rowHeight+marginHeight;